<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="/logo.png" />
    <link rel="stylesheet" href="/blog-worklife/umi.3ec1f225.css" />
    <script>
      window.routerBase = "/blog-worklife";
    </script>
    <script>
      //! umi version: 3.5.41
    </script>
    <script>
      !(function () {
        var e =
            navigator.cookieEnabled && void 0 !== window.localStorage
              ? localStorage.getItem("dumi:prefers-color")
              : "auto",
          o = window.matchMedia("(prefers-color-scheme: dark)").matches,
          t = ["light", "dark", "auto"];
        document.documentElement.setAttribute(
          "data-prefers-color",
          e === t[2] ? (o ? t[1] : t[0]) : t.indexOf(e) > -1 ? e : t[0]
        );
      })();
    </script>
    <title>
      27｜量化实战：从0到1搭建起一套简单的量化投资系统（下） - 大师兄
    </title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/程序员的个人财富课/05.投资进阶篇/08" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;/logo.png&#x27;)" href="/blog-worklife/">大师兄</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span>后端开发<ul><li><a href="/blog-worklife/大规模数据处理实战">大规模数据处理实战</a></li></ul></span><span>工作生活<ul><li><a href="/blog-worklife/10x程序员工作法">10x程序员工作法</a></li><li><a href="/blog-worklife/python自动化办公实战课">python自动化办公实战课</a></li><li><a href="/blog-worklife/人人都用得上的写作课">人人都用得上的写作课</a></li><li><a href="/blog-worklife/体验设计案例课">体验设计案例课</a></li><li><a href="/blog-worklife/基于人因的用户体验设计课">基于人因的用户体验设计课</a></li><li><a href="/blog-worklife/打造爆款短视频">打造爆款短视频</a></li><li><a href="/blog-worklife/用户体验设计实战课">用户体验设计实战课</a></li><li><a aria-current="page" class="active" href="/blog-worklife/程序员的个人财富课">程序员的个人财富课</a></li><li><a href="/blog-worklife/程序员进阶攻略">程序员进阶攻略</a></li><li><a href="/blog-worklife/讲好故事">讲好故事</a></li><li><a href="/blog-worklife/跟着高手学复盘">跟着高手学复盘</a></li></ul></span><div class="__dumi-default-navbar-tool"><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "></div></div></div></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;/logo.png&#x27;)" href="/blog-worklife/"></a><h1>大师兄</h1><p></p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li>后端开发<ul><li><a href="/blog-worklife/大规模数据处理实战">大规模数据处理实战</a></li></ul></li><li>工作生活<ul><li><a href="/blog-worklife/10x程序员工作法">10x程序员工作法</a></li><li><a href="/blog-worklife/python自动化办公实战课">python自动化办公实战课</a></li><li><a href="/blog-worklife/人人都用得上的写作课">人人都用得上的写作课</a></li><li><a href="/blog-worklife/体验设计案例课">体验设计案例课</a></li><li><a href="/blog-worklife/基于人因的用户体验设计课">基于人因的用户体验设计课</a></li><li><a href="/blog-worklife/打造爆款短视频">打造爆款短视频</a></li><li><a href="/blog-worklife/用户体验设计实战课">用户体验设计实战课</a></li><li><a aria-current="page" class="active" href="/blog-worklife/程序员的个人财富课">程序员的个人财富课</a></li><li><a href="/blog-worklife/程序员进阶攻略">程序员进阶攻略</a></li><li><a href="/blog-worklife/讲好故事">讲好故事</a></li><li><a href="/blog-worklife/跟着高手学复盘">跟着高手学复盘</a></li></ul></li></ul><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "><button title="Dark theme" class="__dumi-default-dark-moon "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3854" width="22" height="22"><path d="M991.816611 674.909091a69.166545 69.166545 0 0 0-51.665455-23.272727 70.795636 70.795636 0 0 0-27.438545 5.585454A415.674182 415.674182 0 0 1 754.993338 698.181818c-209.594182 0-393.472-184.785455-393.472-395.636363 0-52.363636 38.539636-119.621818 69.515637-173.614546 4.887273-8.610909 9.634909-16.756364 14.103272-24.901818A69.818182 69.818182 0 0 0 384.631156 0a70.842182 70.842182 0 0 0-27.438545 5.585455C161.678429 90.298182 14.362065 307.898182 14.362065 512c0 282.298182 238.824727 512 532.38691 512a522.286545 522.286545 0 0 0 453.957818-268.334545A69.818182 69.818182 0 0 0 991.816611 674.909091zM546.679156 954.181818c-248.785455 0-462.941091-192-462.941091-442.181818 0-186.647273 140.637091-372.829091 300.939637-442.181818-36.817455 65.629091-92.578909 151.970909-92.578909 232.727273 0 250.181818 214.109091 465.454545 462.917818 465.454545a488.331636 488.331636 0 0 0 185.181091-46.545455 453.003636 453.003636 0 0 1-393.565091 232.727273z m103.656728-669.323636l-14.266182 83.781818a34.909091 34.909091 0 0 0 50.362182 36.770909l74.775272-39.563636 74.752 39.563636a36.142545 36.142545 0 0 0 16.174546 3.956364 34.909091 34.909091 0 0 0 34.210909-40.727273l-14.289455-83.781818 60.509091-59.345455a35.025455 35.025455 0 0 0-19.223272-59.578182l-83.61891-12.101818-37.376-76.101818a34.56 34.56 0 0 0-62.254545 0l-37.376 76.101818-83.618909 12.101818a34.909091 34.909091 0 0 0-19.246546 59.578182z m70.423272-64.698182a34.280727 34.280727 0 0 0 26.135273-19.083636l14.312727-29.090909 14.336 29.090909a34.257455 34.257455 0 0 0 26.135273 19.083636l32.046546 4.887273-23.272728 22.574545a35.234909 35.234909 0 0 0-10.007272 30.952727l5.46909 32.116364-28.625454-15.127273a34.490182 34.490182 0 0 0-32.302546 0l-28.695272 15.127273 5.469091-32.116364a35.141818 35.141818 0 0 0-9.984-30.952727l-23.272728-22.574545z" p-id="3855"></path></svg></button><button title="Light theme" class="__dumi-default-dark-sun "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4026" width="22" height="22"><path d="M915.2 476.16h-43.968c-24.704 0-44.736 16-44.736 35.84s20.032 35.904 44.736 35.904H915.2c24.768 0 44.8-16.064 44.8-35.904s-20.032-35.84-44.8-35.84zM512 265.6c-136.704 0-246.464 109.824-246.464 246.4 0 136.704 109.76 246.464 246.464 246.464S758.4 648.704 758.4 512c0-136.576-109.696-246.4-246.4-246.4z m0 425.6c-99.008 0-179.2-80.128-179.2-179.2 0-98.944 80.192-179.2 179.2-179.2S691.2 413.056 691.2 512c0 99.072-80.192 179.2-179.2 179.2zM197.44 512c0-19.84-19.136-35.84-43.904-35.84H108.8c-24.768 0-44.8 16-44.8 35.84s20.032 35.904 44.8 35.904h44.736c24.768 0 43.904-16.064 43.904-35.904zM512 198.464c19.776 0 35.84-20.032 35.84-44.8v-44.8C547.84 84.032 531.84 64 512 64s-35.904 20.032-35.904 44.8v44.8c0 24.768 16.128 44.864 35.904 44.864z m0 627.136c-19.776 0-35.904 20.032-35.904 44.8v44.736C476.096 940.032 492.16 960 512 960s35.84-20.032 35.84-44.8v-44.736c0-24.768-16.064-44.864-35.84-44.864z m329.92-592.832c17.472-17.536 20.288-43.072 6.4-57.024-14.016-14.016-39.488-11.2-57.024 6.336-4.736 4.864-26.496 26.496-31.36 31.36-17.472 17.472-20.288 43.008-6.336 57.024 13.952 14.016 39.488 11.2 57.024-6.336 4.8-4.864 26.496-26.56 31.296-31.36zM213.376 759.936c-4.864 4.8-26.56 26.624-31.36 31.36-17.472 17.472-20.288 42.944-6.4 56.96 14.016 13.952 39.552 11.2 57.024-6.336 4.8-4.736 26.56-26.496 31.36-31.36 17.472-17.472 20.288-43.008 6.336-56.96-14.016-13.952-39.552-11.072-56.96 6.336z m19.328-577.92c-17.536-17.536-43.008-20.352-57.024-6.336-14.08 14.016-11.136 39.488 6.336 57.024 4.864 4.864 26.496 26.56 31.36 31.424 17.536 17.408 43.008 20.288 56.96 6.336 14.016-14.016 11.264-39.488-6.336-57.024-4.736-4.864-26.496-26.56-31.296-31.424z m527.168 628.608c4.864 4.864 26.624 26.624 31.36 31.424 17.536 17.408 43.072 20.224 57.088 6.336 13.952-14.016 11.072-39.552-6.4-57.024-4.864-4.8-26.56-26.496-31.36-31.36-17.472-17.408-43.072-20.288-57.024-6.336-13.952 14.016-11.008 39.488 6.336 56.96z" p-id="4027"></path></svg></button><button title="Default to system" class="__dumi-default-dark-auto "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11002" width="22" height="22"><path d="M127.658667 492.885333c0-51.882667 10.24-101.717333 30.378666-149.162666s47.786667-88.064 81.92-122.538667 75.093333-61.781333 122.538667-81.92 96.938667-30.378667 149.162667-30.378667 101.717333 10.24 149.162666 30.378667 88.405333 47.786667 122.88 81.92 61.781333 75.093333 81.92 122.538667 30.378667 96.938667 30.378667 149.162666-10.24 101.717333-30.378667 149.162667-47.786667 88.405333-81.92 122.88-75.093333 61.781333-122.88 81.92-97.28 30.378667-149.162666 30.378667-101.717333-10.24-149.162667-30.378667-88.064-47.786667-122.538667-81.92-61.781333-75.093333-81.92-122.88-30.378667-96.938667-30.378666-149.162667z m329.045333 0c0 130.048 13.994667 244.394667 41.984 343.381334h12.970667c46.762667 0 91.136-9.216 133.461333-27.306667s78.848-42.666667 109.568-73.386667 54.954667-67.242667 73.386667-109.568 27.306667-86.698667 27.306666-133.461333c0-46.421333-9.216-90.794667-27.306666-133.12s-42.666667-78.848-73.386667-109.568-67.242667-54.954667-109.568-73.386667-86.698667-27.306667-133.461333-27.306666h-11.605334c-28.672 123.562667-43.349333 237.909333-43.349333 343.722666z" p-id="11003"></path></svg></button></div></div></div><ul class="__dumi-default-menu-list"><li><a href="/blog-worklife/程序员的个人财富课">程序员的个人财富课</a></li><li><a href="/blog-worklife/程序员的个人财富课/01.开篇词">01.开篇词</a><ul><li><a href="/blog-worklife/程序员的个人财富课/01.开篇词/01"><span>开篇词｜为什么说程序员最适合学财富管理？</span></a></li></ul></li><li><a href="/blog-worklife/程序员的个人财富课/02.财富框架篇">02.财富框架篇</a><ul><li><a href="/blog-worklife/程序员的个人财富课/02.财富框架篇/01"><span>01 | 财富框架：建立属于你自己的财富双塔</span></a></li><li><a href="/blog-worklife/程序员的个人财富课/02.财富框架篇/02"><span>02｜个人发展：你自己的发展才是最大的财富源泉</span></a></li><li><a href="/blog-worklife/程序员的个人财富课/02.财富框架篇/03"><span>03｜理财金字塔：如何建立稳固的投资理财结构？</span></a></li><li><a href="/blog-worklife/程序员的个人财富课/02.财富框架篇/04"><span>04｜实战知识：有哪些收益稳健的经典资产配置组合？</span></a></li><li><a href="/blog-worklife/程序员的个人财富课/02.财富框架篇/05"><span>05｜支点投资法：主动投资是讲逻辑的！</span></a></li><li><a href="/blog-worklife/程序员的个人财富课/02.财富框架篇/06"><span>06｜不当韭菜：在财富管理的过程中摆正心态，知己知彼</span></a></li></ul></li><li><a href="/blog-worklife/程序员的个人财富课/03.个人发展篇">03.个人发展篇</a><ul><li><a href="/blog-worklife/程序员的个人财富课/03.个人发展篇/01"><span>07｜职业方向：如何选择一个有前景的职业方向？</span></a></li><li><a href="/blog-worklife/程序员的个人财富课/03.个人发展篇/02"><span>08｜职业规划：大公司VS小公司，怎样选择更有前途？</span></a></li><li><a href="/blog-worklife/程序员的个人财富课/03.个人发展篇/03"><span>09｜期权股权：如何正确处理公司的期权、股权？</span></a></li><li><a href="/blog-worklife/程序员的个人财富课/03.个人发展篇/04"><span>10｜跳槽涨薪：如何规划一条合理的职业道路？</span></a></li><li><a href="/blog-worklife/程序员的个人财富课/03.个人发展篇/05"><span>11 | 财富拓展：35岁失业？程序员如何拓宽财富渠道？</span></a></li></ul></li><li><a href="/blog-worklife/程序员的个人财富课/04.投资实战篇">04.投资实战篇</a><ul><li><a href="/blog-worklife/程序员的个人财富课/04.投资实战篇/01"><span>12｜房产投资：如何做出理性的买房决策？</span></a></li><li><a href="/blog-worklife/程序员的个人财富课/04.投资实战篇/02"><span>13｜实战知识：让我们编程计算下怎么还房贷最合适</span></a></li><li><a href="/blog-worklife/程序员的个人财富课/04.投资实战篇/03"><span>14｜基金投资：如何让专业人士帮你赚钱？</span></a></li><li><a href="/blog-worklife/程序员的个人财富课/04.投资实战篇/04"><span>15｜实战知识：如何选出一只优质的基金？</span></a></li><li><a href="/blog-worklife/程序员的个人财富课/04.投资实战篇/05"><span>16｜股票投资：最适合散户的股票投资方法是什么？</span></a></li><li><a href="/blog-worklife/程序员的个人财富课/04.投资实战篇/06"><span>17｜投资闭环：如何成为越来越专业的投资者？</span></a></li><li><a href="/blog-worklife/程序员的个人财富课/04.投资实战篇/07"><span>18｜技术优势：程序员如何用技术超越其他投资者？</span></a></li><li><a href="/blog-worklife/程序员的个人财富课/04.投资实战篇/08"><span>19｜量化投资：典型的量化投资系统都包含哪些模块？</span></a></li></ul></li><li><a aria-current="page" class="active" href="/blog-worklife/程序员的个人财富课/05.投资进阶篇">05.投资进阶篇</a><ul><li><a href="/blog-worklife/程序员的个人财富课/05.投资进阶篇/01"><span>20｜价值投资：永远不过时的中长期投资策略</span></a></li><li><a href="/blog-worklife/程序员的个人财富课/05.投资进阶篇/02"><span>21｜趋势跟踪：怎样跟着趋势一起赚钱？</span></a></li><li><a href="/blog-worklife/程序员的个人财富课/05.投资进阶篇/03"><span>22｜轮动策略：如何踩准市场变换的节奏？</span></a></li><li><a href="/blog-worklife/程序员的个人财富课/05.投资进阶篇/04"><span>23｜对冲思想：这个世界上有稳赚不赔的生意吗？</span></a></li><li><a href="/blog-worklife/程序员的个人财富课/05.投资进阶篇/05"><span>24｜多因子模型：整合不同策略，形成合力的顶层框架</span></a></li><li><a href="/blog-worklife/程序员的个人财富课/05.投资进阶篇/06"><span>25｜机器学习：我们能用机器学习来建立投资模型吗？</span></a></li><li><a href="/blog-worklife/程序员的个人财富课/05.投资进阶篇/07"><span>26｜量化实战：从0到1搭建起一套简单的量化投资系统（上）</span></a></li><li><a aria-current="page" class="active" href="/blog-worklife/程序员的个人财富课/05.投资进阶篇/08"><span>27｜量化实战：从0到1搭建起一套简单的量化投资系统（下）</span></a></li></ul></li><li><a href="/blog-worklife/程序员的个人财富课/06.投资番外篇">06.投资番外篇</a><ul><li><a href="/blog-worklife/程序员的个人财富课/06.投资番外篇/01"><span>番外一｜王喆对话李腾：程序员对基金经理的灵魂十问（上）</span></a></li><li><a href="/blog-worklife/程序员的个人财富课/06.投资番外篇/02"><span>番外二｜王喆对话李腾：程序员对基金经理的灵魂十问（下）</span></a></li><li><a href="/blog-worklife/程序员的个人财富课/06.投资番外篇/03"><span>番外三｜有哪些能够持续学习的参考资料和相关网站？</span></a></li><li><a href="/blog-worklife/程序员的个人财富课/06.投资番外篇/04"><span>番外四｜知识总结：这门课的全部思维导图</span></a></li></ul></li><li><a href="/blog-worklife/程序员的个人财富课/07.答疑课堂">07.答疑课堂</a><ul><li><a href="/blog-worklife/程序员的个人财富课/07.答疑课堂/01"><span>答疑课堂（一）｜财富框架篇、个人发展篇思考题集锦</span></a></li><li><a href="/blog-worklife/程序员的个人财富课/07.答疑课堂/02"><span>答疑课堂（二）｜投资实战篇、投资进阶篇思考题集锦</span></a></li></ul></li><li><a href="/blog-worklife/程序员的个人财富课/08.结束语">08.结束语</a><ul><li><a href="/blog-worklife/程序员的个人财富课/08.结束语/01"><span>期末考试｜《程序员的个人财富课》满分试卷，等你来挑战！</span></a></li><li><a href="/blog-worklife/程序员的个人财富课/08.结束语/02"><span>结束语 | 知行合一：财富管理是一生的事情</span></a></li></ul></li><li><a href="/blog-worklife/程序员的个人财富课/summary">程序员的个人财富课</a></li></ul></div></div><ul role="slug-list" class="__dumi-default-layout-toc"><li title="管理模块：策略顶层配置方案的制定者" data-depth="2"><a href="/blog-worklife/程序员的个人财富课/05.投资进阶篇/08#管理模块策略顶层配置方案的制定者"><span>管理模块：策略顶层配置方案的制定者</span></a></li><li title="交易模块：交易的实际执行者" data-depth="2"><a href="/blog-worklife/程序员的个人财富课/05.投资进阶篇/08#交易模块交易的实际执行者"><span>交易模块：交易的实际执行者</span></a></li><li title="业绩分析模块：来看看我们的收益是多少" data-depth="2"><a href="/blog-worklife/程序员的个人财富课/05.投资进阶篇/08#业绩分析模块来看看我们的收益是多少"><span>业绩分析模块：来看看我们的收益是多少</span></a></li><li title="借助量化平台的力量，聚焦策略开发" data-depth="2"><a href="/blog-worklife/程序员的个人财富课/05.投资进阶篇/08#借助量化平台的力量聚焦策略开发"><span>借助量化平台的力量，聚焦策略开发</span></a></li><li title="小结" data-depth="2"><a href="/blog-worklife/程序员的个人财富课/05.投资进阶篇/08#小结"><span>小结</span></a></li><li title="思考题" data-depth="2"><a href="/blog-worklife/程序员的个人财富课/05.投资进阶篇/08#思考题"><span>思考题</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="27量化实战从0到1搭建起一套简单的量化投资系统下"><a aria-hidden="true" tabindex="-1" href="/blog-worklife/程序员的个人财富课/05.投资进阶篇/08#27量化实战从0到1搭建起一套简单的量化投资系统下"><span class="icon icon-link"></span></a>27｜量化实战：从0到1搭建起一套简单的量化投资系统（下）</h1><p>你好，我是王喆。这一讲，我们继续进行量化投资实战项目的学习。</p><p>上一讲中，我们一起学习了量化投资项目的技术框图，我讲解了其中的数据中心、策略模块和回测平台三个模块。今天我们来继续学习剩下的模块，包括管理模块、业绩分析模块和模拟交易模块。</p><p><img src="/blog-worklife/static/httpsstatic001geekbangorgresourceimage666b6669538742e3df717999e53d28d9e86b.acc0c7b9.jpg" alt="图片" title="图1 量化投资项目技术框图"/></p><h2 id="管理模块策略顶层配置方案的制定者"><a aria-hidden="true" tabindex="-1" href="/blog-worklife/程序员的个人财富课/05.投资进阶篇/08#管理模块策略顶层配置方案的制定者"><span class="icon icon-link"></span></a>管理模块：策略顶层配置方案的制定者</h2><p>我们在 <a target="_blank" rel="noopener noreferrer" href="https://time.geekbang.org/column/article/410443">19讲<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的时候就已经明确了，<strong>管理模块是整个系统的绝对核心</strong>。一家专业的量化投资公司，每天开盘前做的第一件事就是运行管理模块，分析之前的历史交易，得到当天交易的顶层配置方案。这里的顶层配置方案，可以是不同策略之间的权重占比，也可以是具体投资标的的持仓方案。在实际执行过程中，需要根据公司不同的风格来决定。</p><p>那就回到我们的量化投资系统。上一讲，我们已经通过回测平台决定了不同策略之间的权重，即日历策略占50%，可空仓轮动策略占50%。那么，为了制定出当天交易的详细方案，管理模块需要根据不同策略的权重，制定出一个可行的“持仓目标”。下面的程序就是来完成这个过程的。</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">&quot;&quot;&quot;</span></div><div class="token-line"><span class="token plain">        开盘前</span></div><div class="token-line"><span class="token plain">    &quot;&quot;&quot;</span></div><div class="token-line"><span class="token plain">    T = datetime.date(2020,8,3) # 设置拟交易日期</span></div><div class="token-line"><span class="token plain">    target_amount = 100000 # 目标投资金额</span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">    # 读取基础数据：截止T-1日</span></div><div class="token-line"><span class="token plain">    data = get_hist_data(end_date=T-datetime.timedelta(days=1)) </span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">    # 生成目标组合权重</span></div><div class="token-line"><span class="token plain">    target_wgt1 = calendar_stgy(data, start_date=T, end_date=T, params={&#x27;index_id&#x27;:&#x27;csi1000&#x27;, &#x27;t1&#x27;:1, &#x27;t2&#x27;:5})</span></div><div class="token-line"><span class="token plain">    target_wgt2 = rotation_stgy1(data, start_date=T, end_date=T, params={&#x27;N&#x27;:20})</span></div><div class="token-line"><span class="token plain">    target_wgt = 0.5*target_wgt1 + 0.5*target_wgt2</span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">    # 输出目标持仓市值</span></div><div class="token-line"><span class="token plain">    target_mv = target_wgt * target_amount</span></div><div class="token-line"><span class="token plain">    print(&#x27;目标持仓市值：&#x27;)</span></div><div class="token-line"><span class="token plain">    display(target_mv)</span></div></pre></div><p>我们假设今天的交易日期是2020年8月3日，可用的资金总额是100000元。首先，通过get_hist_data函数从数据中心读出截止到上一个交易日的历史数据；然后，利用在回测平台测试好的混合策略，生成今天的目标持仓target_wgt；最后，用目标持仓乘以资金总额，就得到了今天我们希望达成的各标的的目标持仓市值target_mv。</p><p>通过打印target_mv可以看到，我们今天希望把资金调整成下面的分布：中证1000指数（csi1000）投资50000元，中证500指数（csi500）投资50000元。</p><p><img src="data:image/png;base64,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" alt="图片" title="图2 2020年8月3日的目标持仓市值"/></p><p>在确定了目标持仓之后，管理模块就会调用交易模块来执行具体的交易，以达成上面得到的交易目标。在一天的交易结束之后，管理模块还会调用业绩分析模块，来分析总结当天的盈亏情况。接下来，我就分别讲解下交易模块和业绩分析模块。</p><h2 id="交易模块交易的实际执行者"><a aria-hidden="true" tabindex="-1" href="/blog-worklife/程序员的个人财富课/05.投资进阶篇/08#交易模块交易的实际执行者"><span class="icon icon-link"></span></a>交易模块：交易的实际执行者</h2><p><strong>交易模块是交易的实际执行者</strong>。在真实的量化投资系统中，我们会通过两种方式实现交易模块。</p><p>一种是<strong>自动化交易</strong>。它是通过调用交易所或第三方公司提供的交易API来实现的。例如，我们在<a target="_blank" rel="noopener noreferrer" href="https://time.geekbang.org/column/article/409852">18讲<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中提到的CTP接口，就是上海期货交易所提供的供期货自动化交易的API。</p><p>另一种是<strong>交易员手动交易</strong>。交易员会根据量化投资系统生成的交易目标，通过手动下单的方式来完成这个交易目标。</p><p>我们这个项目选择了模拟手动交易的方式，没有创建真实的交易模块，主要是因为股票交易目前还没有官方的或合法的针对散户的交易API。因此，我们无法实现真实意义上的自动化交易。在进行业绩分析的时候，我们会<strong>假设系统的交易总是可以达成当天的交易目标</strong>。针对沪深300等指数，这个假设也是充分合理的，因为散户的资金量有限，我们总是可以非常容易地达成当天的交易仓位目标。</p><p>这时候，可能有同学会问了：对于沪深300、中证500这些指数，我们应该投资什么标的呢？这是个好问题，因为它们并不是某一只具体的股票，没有办法直接通过购买个股的方式来投资。这里我介绍<strong>两种方便且手续费低廉的投资指数的方法</strong>。</p><p>第一种方法是我最推荐的，就是<strong>场内ETF基金</strong>。场内基金就是指在股票交易所挂牌上市的基金，像股票一样能够用股票账户进行买卖交易。也就是说，只要你开了股票账户，就能够交易场内基金。而且场内ETF基金的交易费率非常低，只有万分之一到万分之五。</p><p>与之对应的就是场外基金了，它指的就是平时我们可以在支付宝等理财App上购买的基金。它的申购费率一般在1%左右，即使打折后也要0.15%左右。而且，如果你短期卖出的话，还要收1.5%的卖出费用。和场内基金比起来，这是非常昂贵的交易费用。</p><p>我推荐的第二种方法是<strong>场外的C类基金</strong>。如果你没有股票账户，但是希望频繁交易指数基金，那么场外C类基金也是一个可行的选择。C类基金的特点是申赎费用几乎可以忽略不计，但是会增加一个每年0.4%左右的基金销售服务费用。这个特点就让C类基金特别适合作为可以频繁交易的指数基金。</p><p>举例来说，图3显示了中金沪深300C这支C类基金的费率明细，具体的数据你可以看<a target="_blank" rel="noopener noreferrer" href="http://fundf10.eastmoney.com/jjfl_003579.html">这个链接<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。从这张图里你可以看到，申购费率是0。至于赎回费率（即卖出费率），如果7天之内卖出，收1.5%；如果大于7天小于30天，是0.1%；大于30天，是0%。这样的交易费率，对于交易策略是非常友好的。比如我们系统使用的日历策略和轮动策略，交易频率往往是月级别的，那么交易C类基金时就几乎不需要支付手续费。</p><p><img src="/blog-worklife/static/httpsstatic001geekbangorgresourceimage8e458e37ee8d7dfd79c19fda062010fd4a45.ce64d4ce.png" alt="图片" title="图3 某C类基金的交易费率明细"/></p><p>所以总的来说，我们系统的交易模块是一个模拟的交易模块，在管理模块生成目标仓位后，通过手动购买场内ETF或C类基金来执行。由于我们的策略是周到月级频率的，交易费用可以忽略不计，所以整个手动交易过程是完全可行的。</p><h2 id="业绩分析模块来看看我们的收益是多少"><a aria-hidden="true" tabindex="-1" href="/blog-worklife/程序员的个人财富课/05.投资进阶篇/08#业绩分析模块来看看我们的收益是多少"><span class="icon icon-link"></span></a>业绩分析模块：来看看我们的收益是多少</h2><p>交易模块在执行每次交易后，会把交易的成交结果记录在账户持仓记录表中。然后，我们就可以<strong>调用业绩分析模块，来分析我们到底赚了多少钱</strong>了。</p><p>下面就是业绩分析模块的代码：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">&quot;&quot;&quot;</span></div><div class="token-line"><span class="token plain">        业绩分析：定期进行</span></div><div class="token-line"><span class="token plain">    &quot;&quot;&quot;</span></div><div class="token-line"><span class="token plain">    # 从账户持仓记录表读取持仓市值数据</span></div><div class="token-line"><span class="token plain">    hold_mv = pd.read_csv(&#x27;账户持仓记录表.csv&#x27;).set_index(&#x27;date&#x27;) </span></div><div class="token-line"><span class="token plain">    hold_mv.index = [datestr2dtdate(e) for e in hold_mv.index]</span></div><div class="token-line"><span class="token plain">    start_date = hold_mv.index[0]</span></div><div class="token-line"><span class="token plain">    end_date = hold_mv.index[-1]</span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">    # 化为权重</span></div><div class="token-line"><span class="token plain">    hold_wgt = hold_mv.iloc[:,0:4].copy()</span></div><div class="token-line"><span class="token plain">    for t in hold_wgt.index:</span></div><div class="token-line"><span class="token plain">        hold_wgt.loc[t] = hold_wgt.loc[t] / hold_mv.loc[t,&#x27;amount&#x27;]</span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">    # 计算净值</span></div><div class="token-line"><span class="token plain">    data = get_hist_data(end_date=end_date) </span></div><div class="token-line"><span class="token plain">    asset_ret = data.pct_change().loc[start_date:end_date]</span></div><div class="token-line"><span class="token plain">    res = (1+asset_ret).cumprod()</span></div><div class="token-line"><span class="token plain">    res[&#x27;account&#x27;] = (1+(hold_wgt.shift(1) * asset_ret).sum(axis=1)).cumprod()</span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">    # 展示净值曲线图和业绩指标表</span></div><div class="token-line"><span class="token plain">    res.loc[:,[&#x27;hs300&#x27;,&#x27;csi500&#x27;,&#x27;account&#x27;]].plot(figsize=(16,8), grid=True)</span></div><div class="token-line"><span class="token plain">    cal_period_perf_indicator(res.loc[:,[&#x27;hs300&#x27;,&#x27;csi500&#x27;,&#x27;account&#x27;]])</span></div></pre></div><p>这里是怎么计算净值，并算出策略业绩的呢？我们可以结合上面的代码来过一遍这个过程。</p><ul><li>第4行到第8行：从账户持仓记录表里读出了账户每天持有四个指数的市值；</li><li>第11到第13行：根据持仓市值计算出了持仓权重；</li><li>第16到第17行：计算出了这四个指数每天的涨跌幅；</li><li>第19行：这一行是计算账户净值的核心。它就是用每个指数的昨收权重，乘以该指数当天的涨跌幅，然后对四个指数的乘积结果求和，这就是当天账户整体的涨幅。将账户每天的涨幅加1再累乘，就得到了账户净值序列；</li><li>第22行：画出了净值走势图；</li><li>第23行：根据净值计算出了各种业绩指标。</li></ul><p>这里你需要注意的是业绩分析模块和回测模块中业绩分析部分的区别。在真实的量化投资系统中，业绩分析模块的输入一定是交易的实际成交记录，而不是回测过程中的模拟交易记录，这两者是有一定区别的。</p><p>我们来看一个例子：在某个交易日，管理模块发给交易模块的指令是“以不高于每股26元的价格购买10000股公司A的股票”，但是由于在一个交易日内股票价格总是在波动，所以实际成交价总是跟目标成交价有所偏离的。</p><p>比如，交易模块分3次购买了共10000股公司A的股票，平均成交价是25.6元，这就低于管理模块输出的目标价格26元。在业绩分析模块计算实际业绩时，就要利用账户持仓记录表或者交易记录表中记录的真实交易记录、持仓情况、交易价格来计算准确的业绩。</p><p>其实公司越大，掌握的资金越多，实际交易结果跟交易目标产生偏差的可能性越大。假设我们的“量化一号”管理了10个亿的资金，这时如果今天计划买入价值1个亿的公司A的股票，那么就极有可能在买入过程中抬升股价，造成无法按照目标价格成交的现象。这时，不仅要求我们通过实现更合理的交易策略来完成交易，在进行业绩分析时也要精准地根据每笔交易的实际成交结果来得出业绩结果。而不是像回测过程中那样，只考虑理想状态下的目标交易结果。</p><p>下面的图4就是我们调用业绩分析模块得出的“量化一号”的净值曲线。其实上一讲在开始的时候已经给出了“量化一号”的效果，这里我们再回顾一下最关键的两个指标：年化收益18.8%，最大回撤29.8%，都比沪深300和中证500指数好很多。再来看综合性的衡量指标，夏普率。在这个维度上，“量化一号”更是达到了1.27，比沪深300的0.38和中证500的0.41都高出不少，其实已经摸到了专业量化产品的门槛。</p><p><img src="/blog-worklife/static/httpsstatic001geekbangorgresourceimagef6dff6f05f0d8433ab946db1b195e31de6df.1c6c939a.png" alt="图片"/></p><p><img src="/blog-worklife/static/httpsstatic001geekbangorgresourceimageyye0yyaf4208f382f4a1aab60a7c628fbde0.cab44199.png" alt="图片" title="图4 “量化一号”（account）与沪深300指数（hs300）、中证500指数（csi500）的效果对比"/></p><p>当然，我们在这里列出“量化一号”的业绩指标，主要是想给你传达这样的信心：普通投资者是可以通过投入一定时间，构建出一套切实可行、效果优于指数定投，甚至基本达到专业量化产品门槛要求的投资策略的。你看，专业投资者和咱们程序员投资者之间，并没有那么大的鸿沟，如果能够充分利用我们的程序员优势，是可以通过量化投资来大幅提升我们的收益率的。</p><h2 id="借助量化平台的力量聚焦策略开发"><a aria-hidden="true" tabindex="-1" href="/blog-worklife/程序员的个人财富课/05.投资进阶篇/08#借助量化平台的力量聚焦策略开发"><span class="icon icon-link"></span></a>借助量化平台的力量，聚焦策略开发</h2><p>好了，到这里我已经完成了对量化投资系统剩余三个模块的讲解。我们最后来看一个问题：如何解决数据、交易接口等问题，来高效地构建一套真正可用的量化投资系统？</p><p>在之前的课程中，有很多同学在留言区问我关于数据和交易接口的问题，比如问有没有公开的、免费的股票或者期货数据，或者有没有可以支持自动化交易的好用的API。这里我可以统一回复下：答案是没有。因为天底下没有免费的午餐。免费的、稳定的、可供随意获取的交易数据源目前是没有的，而万德等专业的交易数据库，费用又是普通投资者不能承受的。</p><p>至于交易API，只有期货的CTP接口是普通投资者能够申请下来的，而且它也有一定门槛。股票类的交易API，干脆对普通投资者完全不开放。</p><p>那我们就没有办法进行量化投资了吗？当然不是。上面说的情况，只是说明我们还没有一个完美的解决方法，并不意味着搭建量化投资系统是完全不可行的。这时候就要开阔我们的思路，不要总是用完美主义的心态来看待一个问题。</p><p>其实，量化投资是一整套解决投资问题的思路。我们完全可以利用量化投资产生交易信号，然后根据交易信号手动交易，来实现个人的量化系统。更何况，我不止一次强调过，我们散户的交易优势在于一些中长期的交易策略。有些量化策略的交易信号一周，甚至一个月才会产生一次，这根本不会给我们增加太多的交易成本。</p><p>如果我们再“懒”一点，连回测平台、数据中心也不想自己开发，只想聚焦于发现能够盈利的交易策略，有没有可行的方案呢？其实也是有的。现在市面上成熟的量化交易平台已经不止一家，它们不只在回测平台内提供免费的回测数据，还提供用来编写和测试策略的线上编译器，甚至还支持交易信号的触达服务，比如通过手机短信、微信小程序的形式发到你的手机上。这样一来，就完全可以利用这些量化交易平台实现我们的量化策略+手动交易的方案了。</p><p>因为市面上的量化交易平台的同质化问题比较严重，这里就不做具体的推荐了。你只要搜索量化交易平台，然后在最靠前的几家中选择一家学习和研究就可以了。希望你能借助这些平台的力量，聚焦策略开发，落地你的量化交易想法！</p><h2 id="小结"><a aria-hidden="true" tabindex="-1" href="/blog-worklife/程序员的个人财富课/05.投资进阶篇/08#小结"><span class="icon icon-link"></span></a>小结</h2><p>今天，我们完成了对量化投资系统剩余三个模块的讲解。希望你学完之后，能够更深入理解典型量化投资系统的框架和实现方法。我把今天的要点总结在这里，你可以再回顾一遍：</p><ol><li>管理模块是整个系统的绝对核心，我们的项目在开盘前调用管理模块，得到当天具体的目标仓位。</li><li>交易模块是交易的实际执行者。在真实的量化投资系统中，系统会通过自动化交易或者手动交易的方式执行交易模块的功能。</li><li>业绩分析模块通过分析实盘交易结果，得到系统的业绩情况。</li><li>接入成熟的量化交易平台可以帮你聚焦在量化策略的研发上，实现量化策略+手动交易的方案。</li></ol><p>学完这一讲，我们就完成了整个投资进阶篇的学习。你可以把最后两讲里的量化投资项目当作整个模块的大作业，完成这个作业之后，我们可以说是把投资策略相关的知识融会贯通了。对于如何实现策略，如何确定策略参数，如何根据策略进行交易这些关键问题，我想你已经有了比较清晰的认识。</p><p>但我们也要明确一点：这两讲只是搭建起了一个相对简单的量化投资系统，和专业的量化投资系统比起来，很多地方还有待完善。不过，这门课的目的已经达到了：我们的项目是一个起点，一个Demo，它可以为我们的业余投资提供很好的支持。如果你有志于从事量化投资这个行业，可以在这个项目的基础上继续精进。如果这门课能成为你入行的起点，也是我们莫大的荣幸。</p><h2 id="思考题"><a aria-hidden="true" tabindex="-1" href="/blog-worklife/程序员的个人财富课/05.投资进阶篇/08#思考题"><span class="icon icon-link"></span></a>思考题</h2><p>到这里，投资进阶篇这个模块我们已经全部学完了。今天的思考题，我希望是一个发散的讨论：你还知道哪些投资策略？或者说，在投资过程中，你冒出过哪些有可能形成策略的想法？</p><p>欢迎你在评论区畅所欲言。不用管这些想法是否成熟，让我们一起交流那些天马行空的想法，让自己的思路更加开阔吧。</p></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/GGwujun/blog/edit/master/ssrc/程序员的个人财富课/05.投资进阶篇/08.md">在 GitHub 上编辑此页<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="最后更新时间：">2023/9/29 14:28:22</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script>
      (function () {
        if (!location.port) {
          (function (i, s, o, g, r, a, m) {
            i["GoogleAnalyticsObject"] = r;
            (i[r] =
              i[r] ||
              function () {
                (i[r].q = i[r].q || []).push(arguments);
              }),
              (i[r].l = 1 * new Date());
            (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m);
          })(
            window,
            document,
            "script",
            "//www.google-analytics.com/analytics.js",
            "ga"
          );
          ga("create", "UA-149864185-1", "auto");
          ga("send", "pageview");
        }
      })();
    </script>
    <script src="/blog-worklife/umi.4ad44284.js"></script>
  </body>
</html>
