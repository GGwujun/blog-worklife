<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="/logo.png" />
    <link rel="stylesheet" href="/blog-worklife/umi.3ec1f225.css" />
    <script>
      window.routerBase = "/blog-worklife";
    </script>
    <script>
      //! umi version: 3.5.41
    </script>
    <script>
      !(function () {
        var e =
            navigator.cookieEnabled && void 0 !== window.localStorage
              ? localStorage.getItem("dumi:prefers-color")
              : "auto",
          o = window.matchMedia("(prefers-color-scheme: dark)").matches,
          t = ["light", "dark", "auto"];
        document.documentElement.setAttribute(
          "data-prefers-color",
          e === t[2] ? (o ? t[1] : t[0]) : t.indexOf(e) > -1 ? e : t[0]
        );
      })();
    </script>
    <title>03 | 大规模数据处理初体验：怎样实现大型电商热销榜？ - 大师兄</title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/大规模数据处理实战/02.模块一 直通硅谷大规模数据处理技术/03" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;/logo.png&#x27;)" href="/blog-worklife/">大师兄</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span>后端开发<ul><li><a aria-current="page" class="active" href="/blog-worklife/大规模数据处理实战">大规模数据处理实战</a></li></ul></span><span>工作生活<ul><li><a href="/blog-worklife/10x程序员工作法">10x程序员工作法</a></li><li><a href="/blog-worklife/python自动化办公实战课">python自动化办公实战课</a></li><li><a href="/blog-worklife/人人都用得上的写作课">人人都用得上的写作课</a></li><li><a href="/blog-worklife/体验设计案例课">体验设计案例课</a></li><li><a href="/blog-worklife/基于人因的用户体验设计课">基于人因的用户体验设计课</a></li><li><a href="/blog-worklife/打造爆款短视频">打造爆款短视频</a></li><li><a href="/blog-worklife/用户体验设计实战课">用户体验设计实战课</a></li><li><a href="/blog-worklife/程序员的个人财富课">程序员的个人财富课</a></li><li><a href="/blog-worklife/程序员进阶攻略">程序员进阶攻略</a></li><li><a href="/blog-worklife/讲好故事">讲好故事</a></li><li><a href="/blog-worklife/跟着高手学复盘">跟着高手学复盘</a></li></ul></span><div class="__dumi-default-navbar-tool"><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "></div></div></div></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;/logo.png&#x27;)" href="/blog-worklife/"></a><h1>大师兄</h1><p></p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li>后端开发<ul><li><a aria-current="page" class="active" href="/blog-worklife/大规模数据处理实战">大规模数据处理实战</a></li></ul></li><li>工作生活<ul><li><a href="/blog-worklife/10x程序员工作法">10x程序员工作法</a></li><li><a href="/blog-worklife/python自动化办公实战课">python自动化办公实战课</a></li><li><a href="/blog-worklife/人人都用得上的写作课">人人都用得上的写作课</a></li><li><a href="/blog-worklife/体验设计案例课">体验设计案例课</a></li><li><a href="/blog-worklife/基于人因的用户体验设计课">基于人因的用户体验设计课</a></li><li><a href="/blog-worklife/打造爆款短视频">打造爆款短视频</a></li><li><a href="/blog-worklife/用户体验设计实战课">用户体验设计实战课</a></li><li><a href="/blog-worklife/程序员的个人财富课">程序员的个人财富课</a></li><li><a href="/blog-worklife/程序员进阶攻略">程序员进阶攻略</a></li><li><a href="/blog-worklife/讲好故事">讲好故事</a></li><li><a href="/blog-worklife/跟着高手学复盘">跟着高手学复盘</a></li></ul></li></ul><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "><button title="Dark theme" class="__dumi-default-dark-moon "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3854" width="22" height="22"><path d="M991.816611 674.909091a69.166545 69.166545 0 0 0-51.665455-23.272727 70.795636 70.795636 0 0 0-27.438545 5.585454A415.674182 415.674182 0 0 1 754.993338 698.181818c-209.594182 0-393.472-184.785455-393.472-395.636363 0-52.363636 38.539636-119.621818 69.515637-173.614546 4.887273-8.610909 9.634909-16.756364 14.103272-24.901818A69.818182 69.818182 0 0 0 384.631156 0a70.842182 70.842182 0 0 0-27.438545 5.585455C161.678429 90.298182 14.362065 307.898182 14.362065 512c0 282.298182 238.824727 512 532.38691 512a522.286545 522.286545 0 0 0 453.957818-268.334545A69.818182 69.818182 0 0 0 991.816611 674.909091zM546.679156 954.181818c-248.785455 0-462.941091-192-462.941091-442.181818 0-186.647273 140.637091-372.829091 300.939637-442.181818-36.817455 65.629091-92.578909 151.970909-92.578909 232.727273 0 250.181818 214.109091 465.454545 462.917818 465.454545a488.331636 488.331636 0 0 0 185.181091-46.545455 453.003636 453.003636 0 0 1-393.565091 232.727273z m103.656728-669.323636l-14.266182 83.781818a34.909091 34.909091 0 0 0 50.362182 36.770909l74.775272-39.563636 74.752 39.563636a36.142545 36.142545 0 0 0 16.174546 3.956364 34.909091 34.909091 0 0 0 34.210909-40.727273l-14.289455-83.781818 60.509091-59.345455a35.025455 35.025455 0 0 0-19.223272-59.578182l-83.61891-12.101818-37.376-76.101818a34.56 34.56 0 0 0-62.254545 0l-37.376 76.101818-83.618909 12.101818a34.909091 34.909091 0 0 0-19.246546 59.578182z m70.423272-64.698182a34.280727 34.280727 0 0 0 26.135273-19.083636l14.312727-29.090909 14.336 29.090909a34.257455 34.257455 0 0 0 26.135273 19.083636l32.046546 4.887273-23.272728 22.574545a35.234909 35.234909 0 0 0-10.007272 30.952727l5.46909 32.116364-28.625454-15.127273a34.490182 34.490182 0 0 0-32.302546 0l-28.695272 15.127273 5.469091-32.116364a35.141818 35.141818 0 0 0-9.984-30.952727l-23.272728-22.574545z" p-id="3855"></path></svg></button><button title="Light theme" class="__dumi-default-dark-sun "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4026" width="22" height="22"><path d="M915.2 476.16h-43.968c-24.704 0-44.736 16-44.736 35.84s20.032 35.904 44.736 35.904H915.2c24.768 0 44.8-16.064 44.8-35.904s-20.032-35.84-44.8-35.84zM512 265.6c-136.704 0-246.464 109.824-246.464 246.4 0 136.704 109.76 246.464 246.464 246.464S758.4 648.704 758.4 512c0-136.576-109.696-246.4-246.4-246.4z m0 425.6c-99.008 0-179.2-80.128-179.2-179.2 0-98.944 80.192-179.2 179.2-179.2S691.2 413.056 691.2 512c0 99.072-80.192 179.2-179.2 179.2zM197.44 512c0-19.84-19.136-35.84-43.904-35.84H108.8c-24.768 0-44.8 16-44.8 35.84s20.032 35.904 44.8 35.904h44.736c24.768 0 43.904-16.064 43.904-35.904zM512 198.464c19.776 0 35.84-20.032 35.84-44.8v-44.8C547.84 84.032 531.84 64 512 64s-35.904 20.032-35.904 44.8v44.8c0 24.768 16.128 44.864 35.904 44.864z m0 627.136c-19.776 0-35.904 20.032-35.904 44.8v44.736C476.096 940.032 492.16 960 512 960s35.84-20.032 35.84-44.8v-44.736c0-24.768-16.064-44.864-35.84-44.864z m329.92-592.832c17.472-17.536 20.288-43.072 6.4-57.024-14.016-14.016-39.488-11.2-57.024 6.336-4.736 4.864-26.496 26.496-31.36 31.36-17.472 17.472-20.288 43.008-6.336 57.024 13.952 14.016 39.488 11.2 57.024-6.336 4.8-4.864 26.496-26.56 31.296-31.36zM213.376 759.936c-4.864 4.8-26.56 26.624-31.36 31.36-17.472 17.472-20.288 42.944-6.4 56.96 14.016 13.952 39.552 11.2 57.024-6.336 4.8-4.736 26.56-26.496 31.36-31.36 17.472-17.472 20.288-43.008 6.336-56.96-14.016-13.952-39.552-11.072-56.96 6.336z m19.328-577.92c-17.536-17.536-43.008-20.352-57.024-6.336-14.08 14.016-11.136 39.488 6.336 57.024 4.864 4.864 26.496 26.56 31.36 31.424 17.536 17.408 43.008 20.288 56.96 6.336 14.016-14.016 11.264-39.488-6.336-57.024-4.736-4.864-26.496-26.56-31.296-31.424z m527.168 628.608c4.864 4.864 26.624 26.624 31.36 31.424 17.536 17.408 43.072 20.224 57.088 6.336 13.952-14.016 11.072-39.552-6.4-57.024-4.864-4.8-26.56-26.496-31.36-31.36-17.472-17.408-43.072-20.288-57.024-6.336-13.952 14.016-11.008 39.488 6.336 56.96z" p-id="4027"></path></svg></button><button title="Default to system" class="__dumi-default-dark-auto "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11002" width="22" height="22"><path d="M127.658667 492.885333c0-51.882667 10.24-101.717333 30.378666-149.162666s47.786667-88.064 81.92-122.538667 75.093333-61.781333 122.538667-81.92 96.938667-30.378667 149.162667-30.378667 101.717333 10.24 149.162666 30.378667 88.405333 47.786667 122.88 81.92 61.781333 75.093333 81.92 122.538667 30.378667 96.938667 30.378667 149.162666-10.24 101.717333-30.378667 149.162667-47.786667 88.405333-81.92 122.88-75.093333 61.781333-122.88 81.92-97.28 30.378667-149.162666 30.378667-101.717333-10.24-149.162667-30.378667-88.064-47.786667-122.538667-81.92-61.781333-75.093333-81.92-122.88-30.378667-96.938667-30.378666-149.162667z m329.045333 0c0 130.048 13.994667 244.394667 41.984 343.381334h12.970667c46.762667 0 91.136-9.216 133.461333-27.306667s78.848-42.666667 109.568-73.386667 54.954667-67.242667 73.386667-109.568 27.306667-86.698667 27.306666-133.461333c0-46.421333-9.216-90.794667-27.306666-133.12s-42.666667-78.848-73.386667-109.568-67.242667-54.954667-109.568-73.386667-86.698667-27.306667-133.461333-27.306666h-11.605334c-28.672 123.562667-43.349333 237.909333-43.349333 343.722666z" p-id="11003"></path></svg></button></div></div></div><ul class="__dumi-default-menu-list"><li><a href="/blog-worklife/大规模数据处理实战">大规模数据处理实战</a></li><li><a href="/blog-worklife/大规模数据处理实战/01.开篇词">01.开篇词</a><ul><li><a href="/blog-worklife/大规模数据处理实战/01.开篇词/01"><span>开篇词 | 从这里开始，带你走上硅谷一线系统架构师之路</span></a></li></ul></li><li><a aria-current="page" class="active" href="/blog-worklife/大规模数据处理实战/02.模块一 直通硅谷大规模数据处理技术">02.模块一 直通硅谷大规模数据处理技术</a><ul><li><a href="/blog-worklife/大规模数据处理实战/02.模块一 直通硅谷大规模数据处理技术/01"><span>01 | 为什么MapReduce会被硅谷一线公司淘汰？</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/02.模块一 直通硅谷大规模数据处理技术/02"><span>02 | MapReduce后谁主沉浮：怎样设计下一代数据处理技术？</span></a></li><li><a aria-current="page" class="active" href="/blog-worklife/大规模数据处理实战/02.模块一 直通硅谷大规模数据处理技术/03"><span>03 | 大规模数据处理初体验：怎样实现大型电商热销榜？</span></a></li></ul></li><li><a href="/blog-worklife/大规模数据处理实战/03.模块二 实战学习大规模数据处理基本功">03.模块二 实战学习大规模数据处理基本功</a><ul><li><a href="/blog-worklife/大规模数据处理实战/03.模块二 实战学习大规模数据处理基本功/01"><span>04 | 分布式系统（上）：学会用服务等级协议SLA来评估你的系统</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/03.模块二 实战学习大规模数据处理基本功/02"><span>05 | 分布式系统（下）：架构师不得不知的三大指标</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/03.模块二 实战学习大规模数据处理基本功/03"><span>06 | 如何区分批处理还是流处理？</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/03.模块二 实战学习大规模数据处理基本功/04"><span>07 | Workflow设计模式：让你在大规模数据世界中君临天下</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/03.模块二 实战学习大规模数据处理基本功/05"><span>08 | 发布/订阅模式：流处理架构中的瑞士军刀</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/03.模块二 实战学习大规模数据处理基本功/06"><span>09 | CAP定理：三选二，架构师必须学会的取舍</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/03.模块二 实战学习大规模数据处理基本功/07"><span>10 | Lambda架构：Twitter亿级实时数据分析架构背后的倚天剑</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/03.模块二 实战学习大规模数据处理基本功/08"><span>11 | Kappa架构：利用Kafka锻造的屠龙刀</span></a></li></ul></li><li><a href="/blog-worklife/大规模数据处理实战/04.模块三 抽丝剥茧剖析apache-spark设计精髓">04.模块三 抽丝剥茧剖析ApacheSpark设计精髓</a><ul><li><a href="/blog-worklife/大规模数据处理实战/04.模块三 抽丝剥茧剖析apache-spark设计精髓/01"><span>12 | 我们为什么需要Spark？</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/04.模块三 抽丝剥茧剖析apache-spark设计精髓/02"><span>13 | 弹性分布式数据集：Spark大厦的地基（上）</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/04.模块三 抽丝剥茧剖析apache-spark设计精髓/03"><span>14 | 弹性分布式数据集：Spark大厦的地基（下）</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/04.模块三 抽丝剥茧剖析apache-spark设计精髓/04"><span>15 | Spark SQL：Spark数据查询的利器</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/04.模块三 抽丝剥茧剖析apache-spark设计精髓/05"><span>16 | Spark Streaming：Spark的实时流计算API</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/04.模块三 抽丝剥茧剖析apache-spark设计精髓/06"><span>17 | Structured Streaming：如何用DataFrame API进行实时数据分析?</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/04.模块三 抽丝剥茧剖析apache-spark设计精髓/07"><span>18 | Word Count：从零开始运行你的第一个Spark应用</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/04.模块三 抽丝剥茧剖析apache-spark设计精髓/08"><span>19 | 综合案例实战：处理加州房屋信息，构建线性回归模型</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/04.模块三 抽丝剥茧剖析apache-spark设计精髓/09"><span>20 | 流处理案例实战：分析纽约市出租车载客信息</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/04.模块三 抽丝剥茧剖析apache-spark设计精髓/10"><span>21 | 深入对比Spark与Flink：帮你系统设计两开花</span></a></li></ul></li><li><a href="/blog-worklife/大规模数据处理实战/05.模块四 apache-beam为何能一统江湖">05.模块四 ApacheBeam为何能一统江湖</a><ul><li><a href="/blog-worklife/大规模数据处理实战/05.模块四 apache-beam为何能一统江湖/01"><span>22 | Apache Beam的前世今生</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/05.模块四 apache-beam为何能一统江湖/02"><span>23 | 站在Google的肩膀上学习Beam编程模型</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/05.模块四 apache-beam为何能一统江湖/03"><span>24 | PCollection：为什么Beam要如此抽象封装数据？</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/05.模块四 apache-beam为何能一统江湖/04"><span>25 | Transform：Beam数据转换操作的抽象方法</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/05.模块四 apache-beam为何能一统江湖/05"><span>26 | Pipeline：Beam如何抽象多步骤的数据流水线？</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/05.模块四 apache-beam为何能一统江湖/06"><span>27 | Pipeline I/O: Beam数据中转的设计模式</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/05.模块四 apache-beam为何能一统江湖/07"><span>28 | 如何设计创建好一个Beam Pipeline？</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/05.模块四 apache-beam为何能一统江湖/08"><span>29 | 如何测试Beam Pipeline？</span></a></li></ul></li><li><a href="/blog-worklife/大规模数据处理实战/06.模块五 决战apache-beam真实硅谷案例">06.模块五 决战ApacheBeam真实硅谷案例</a><ul><li><a href="/blog-worklife/大规模数据处理实战/06.模块五 决战apache-beam真实硅谷案例/01"><span>30 | Apache Beam实战冲刺：Beam如何run everywhere?</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/06.模块五 决战apache-beam真实硅谷案例/02"><span>31 | WordCount Beam Pipeline实战</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/06.模块五 决战apache-beam真实硅谷案例/03"><span>32 | Beam Window：打通流处理的任督二脉</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/06.模块五 决战apache-beam真实硅谷案例/04"><span>33 | 横看成岭侧成峰：再战Streaming WordCount</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/06.模块五 决战apache-beam真实硅谷案例/05"><span>34 | Amazon热销榜Beam Pipeline实战</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/06.模块五 决战apache-beam真实硅谷案例/06"><span>35 | Facebook游戏实时流处理Beam Pipeline实战（上）</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/06.模块五 决战apache-beam真实硅谷案例/07"><span>36 | Facebook游戏实时流处理Beam Pipeline实战（下）</span></a></li></ul></li><li><a href="/blog-worklife/大规模数据处理实战/07.模块六 大规模数据处理的挑战与未来">07.模块六 大规模数据处理的挑战与未来</a><ul><li><a href="/blog-worklife/大规模数据处理实战/07.模块六 大规模数据处理的挑战与未来/01"><span>37 | 5G时代，如何处理超大规模物联网数据</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/07.模块六 大规模数据处理的挑战与未来/02"><span>38 | 大规模数据处理在深度学习中如何应用？</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/07.模块六 大规模数据处理的挑战与未来/03"><span>39 | 从SQL到Streaming SQL：突破静态数据查询的次元</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/07.模块六 大规模数据处理的挑战与未来/04"><span>40 | 大规模数据处理未来之路</span></a></li></ul></li><li><a href="/blog-worklife/大规模数据处理实战/08.专栏加餐 特别福利">08.专栏加餐 特别福利</a><ul><li><a href="/blog-worklife/大规模数据处理实战/08.专栏加餐 特别福利/01"><span>FAQ第一期 | 学习大规模数据处理需要什么基础？</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/08.专栏加餐 特别福利/02"><span>加油站 | Practice makes perfect！</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/08.专栏加餐 特别福利/03"><span>FAQ第二期 | Spark案例实战答疑</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/08.专栏加餐 特别福利/04"><span>FAQ第三期 | Apache Beam基础答疑</span></a></li></ul></li><li><a href="/blog-worklife/大规模数据处理实战/09.结束语">09.结束语</a><ul><li><a href="/blog-worklife/大规模数据处理实战/09.结束语/01"><span>结束语 | 世间所有的相遇，都是久别重逢</span></a></li></ul></li><li><a href="/blog-worklife/大规模数据处理实战/summary">大规模数据处理实战</a></li></ul></div></div><ul role="slug-list" class="__dumi-default-layout-toc"><li title="小规模的经典算法" data-depth="2"><a href="/blog-worklife/大规模数据处理实战/02.模块一 直通硅谷大规模数据处理技术/03#小规模的经典算法"><span>小规模的经典算法</span></a></li><li title="大规模分布式解决方案" data-depth="2"><a href="/blog-worklife/大规模数据处理实战/02.模块一 直通硅谷大规模数据处理技术/03#大规模分布式解决方案"><span>大规模分布式解决方案</span></a></li><li title="统计每个商品的销量" data-depth="3"><a href="/blog-worklife/大规模数据处理实战/02.模块一 直通硅谷大规模数据处理技术/03#统计每个商品的销量"><span>统计每个商品的销量</span></a></li><li title="找出销量前K" data-depth="3"><a href="/blog-worklife/大规模数据处理实战/02.模块一 直通硅谷大规模数据处理技术/03#找出销量前k"><span>找出销量前K</span></a></li><li title="汇总最终结果" data-depth="3"><a href="/blog-worklife/大规模数据处理实战/02.模块一 直通硅谷大规模数据处理技术/03#汇总最终结果"><span>汇总最终结果</span></a></li><li title="大规模数据处理框架的功能要求" data-depth="2"><a href="/blog-worklife/大规模数据处理实战/02.模块一 直通硅谷大规模数据处理技术/03#大规模数据处理框架的功能要求"><span>大规模数据处理框架的功能要求</span></a></li><li title="小结" data-depth="2"><a href="/blog-worklife/大规模数据处理实战/02.模块一 直通硅谷大规模数据处理技术/03#小结"><span>小结</span></a></li><li title="思考题" data-depth="2"><a href="/blog-worklife/大规模数据处理实战/02.模块一 直通硅谷大规模数据处理技术/03#思考题"><span>思考题</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="03--大规模数据处理初体验怎样实现大型电商热销榜"><a aria-hidden="true" tabindex="-1" href="/blog-worklife/大规模数据处理实战/02.模块一 直通硅谷大规模数据处理技术/03#03--大规模数据处理初体验怎样实现大型电商热销榜"><span class="icon icon-link"></span></a>03 | 大规模数据处理初体验：怎样实现大型电商热销榜？</h1><p>你好，我是蔡元楠。</p><p>今天我要与你分享的主题是“怎样实现大型电商热销榜”。</p><p>我在Google面试过很多优秀的候选人，应对普通的编程问题coding能力很强，算法数据结构也应用得不错。</p><p>可是当我追问数据规模变大时该怎么设计系统，他们却说不出所以然来。这说明他们缺乏必备的规模增长的技术思维（mindset of scaling）。这会限制这些候选人的职业成长。</p><p>因为产品从1万用户到1亿用户，技术团队从10个人到1000个人，你的技术规模和数据规模都会完全不一样。</p><p>今天我们就以大型电商热销榜为例，来谈一谈从1万用户到1亿用户，从GB数据到PB数据系统，技术思维需要怎样的转型升级？</p><p>同样的问题举一反三，可以应用在淘宝热卖，App排行榜，抖音热门，甚至是胡润百富榜，因为实际上他们背后都应用了相似的大规模数据处理技术。</p><p><img src="/blog-worklife/static/httpsstatic001geekbangorgresourceimage46ec469707990cf33d24d8713efab8fe34ec.0df3cc50.png" alt=""/></p><p>真正的排序系统非常复杂，仅仅是用来排序的特征（features）就需要多年的迭代设计。</p><p>为了便于这一讲的讨论，我们来构想一个简化的玩具问题，来帮助你理解。</p><p>假设你的电商网站销售10亿件商品，已经跟踪了网站的销售记录：商品id和购买时间 <!-- -->{<!-- -->product_id, timestamp<!-- -->}<!-- -->，整个交易记录是1000亿行数据，TB级。作为技术负责人，你会怎样设计一个系统，根据销售记录统计去年销量前10的商品呢？</p><p>举个例子，假设我们的数据是：</p><p><img src="/blog-worklife/static/httpsstatic001geekbangorgresourceimagebd9dbdafa7f74c568c107c38317e0a1a669d.e389ddf2.png" alt=""/></p><p>我们可以把热销榜按 product_id 排名为：1, 2, 3。</p><h2 id="小规模的经典算法"><a aria-hidden="true" tabindex="-1" href="/blog-worklife/大规模数据处理实战/02.模块一 直通硅谷大规模数据处理技术/03#小规模的经典算法"><span class="icon icon-link"></span></a>小规模的经典算法</h2><p>如果上过极客时间的《数据结构与算法之美》，你可能一眼就看出来，这个问题的解法分为两步：</p><p><img src="/blog-worklife/static/httpsstatic001geekbangorgresourceimage3eaf3eaea261df4257f0cff4509d82f211af.2e19b0d4.png" alt=""/></p><p>第一步，统计每个商品的销量。你可以用哈希表（hashtable）数据结构来解决，是一个O(n)的算法，这里n是1000亿。</p><p>第二步，找出销量前十，可以用经典的Top K算法，也是O(n)的算法。</p><p>如果你考虑到了这些，先恭喜你答对了。</p><p>在小规模系统中，我们确实完全可以用经典的算法简洁漂亮地解决。以Python编程的话可能是类似这样的：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">def CountSales(sale_records):</span></div><div class="token-line"><span class="token plain">      &quot;&quot;&quot;Calculate number of sales for each product id.  </span></div><div class="token-line"><span class="token plain">      </span></div><div class="token-line"><span class="token plain">      Args:</span></div><div class="token-line"><span class="token plain">        sales_records: list of SaleRecord, SaleRecord is a named tuple,     </span></div><div class="token-line"><span class="token plain">          e.g. {product_id: “1”, timestamp: 1553721167}.</span></div><div class="token-line"><span class="token plain">      Returns:</span></div><div class="token-line"><span class="token plain">        dict of {product_id: num_of_sales}. E.g. {“1”: 1, “2”: 1}</span></div><div class="token-line"><span class="token plain">      &quot;&quot;&quot;</span></div><div class="token-line"><span class="token plain">      sales_count = {}</span></div><div class="token-line"><span class="token plain">      for record in sale_records:</span></div><div class="token-line"><span class="token plain">        sales_count[record[product_id]] += 1</span></div><div class="token-line"><span class="token plain">      </span></div><div class="token-line"><span class="token plain">      return sales_count</span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">    def TopSellingItems(sale_records, k=10):  </span></div><div class="token-line"><span class="token plain">      &quot;&quot;&quot;Calculate the best selling k products.  </span></div><div class="token-line"><span class="token plain">      </span></div><div class="token-line"><span class="token plain">      Args:</span></div><div class="token-line"><span class="token plain">        sales_records: list of SaleRecord, SaleRecord is a named tuple,   </span></div><div class="token-line"><span class="token plain">          e.g. {product_id: “1”, timestamp: 1553721167}.</span></div><div class="token-line"><span class="token plain">        K: num of top products you want to output.</span></div><div class="token-line"><span class="token plain">      Returns:</span></div><div class="token-line"><span class="token plain">        List of k product_id, sorted by num of sales.</span></div><div class="token-line"><span class="token plain">      &quot;&quot;&quot;</span></div><div class="token-line"><span class="token plain">      sales_count = CountSales(sale_records)</span></div><div class="token-line"><span class="token plain">      return heapq.nlargest(k, sales_count, key=sales_count.get)</span></div></pre></div><p>但在一切系统中，随着尺度的变大，很多方法就不再适用。</p><p>比如，在小尺度经典物理学中适用的牛顿力学公式是这样的：</p><p><img src="data:image/png;base64,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" alt=""/></p><p>这在高速强力的物理系统中就不再适用，在狭义相对论中有另外的表达。</p><p><img src="/blog-worklife/static/httpsstatic001geekbangorgresourceimage2cf72c59194f8bebaecd88f5942bcccf75f7.40e1f1ba.png" alt=""/></p><p>在社会系统中也是一样，管理10人团队，和治理14亿人口的国家，复杂度也不可同日而语。</p><p>具体在我们这个问题中，同样的Top K算法当数据规模变大会遇到哪些问题呢？</p><p>第一，内存占用。</p><p>对于TB级的交易记录数据，很难找到单台计算机容纳那么大的哈希表了。你可能想到，那我不要用哈希表去统计商品销售量了，我把销量计数放在磁盘里完成好了。</p><p>比如，就用一个1000亿行的文件或者表，然后再把销量统计结果一行一行读进后面的堆树/优先级队列。理论上听起来不错，实际上是否真的可行呢，那我们看下一点。</p><p>第二，磁盘I/O等延时问题。</p><p>当数据规模变大，我们难以避免地需要把一些中间结果存进磁盘，以应对单步任务出错等问题。一次磁盘读取大概需要10ms的时间。</p><p>如果按照上一点提到的文件替代方法，因为我们是一个O(n * log k)的算法，就需要10ms * 10^9 = 10 ^ 7 s = 115 天的时间。你可能需要贾跃亭附体，才能忽悠老板接受这样的设计方案了。</p><p>这些问题怎么解决呢？你可能已经想到，当单台机器已经无法适应我们数据或者问题的规模，我们需要横向扩展。</p><h2 id="大规模分布式解决方案"><a aria-hidden="true" tabindex="-1" href="/blog-worklife/大规模数据处理实战/02.模块一 直通硅谷大规模数据处理技术/03#大规模分布式解决方案"><span class="icon icon-link"></span></a>大规模分布式解决方案</h2><p>之前的思路依然没错。但是，我们需要把每一步从简单的函数算法，升级为计算集群的分布式算法。</p><p><img src="/blog-worklife/static/httpsstatic001geekbangorgresourceimage3eaf3eaea261df4257f0cff4509d82f211af.2e19b0d4.png" alt=""/></p><h3 id="统计每个商品的销量"><a aria-hidden="true" tabindex="-1" href="/blog-worklife/大规模数据处理实战/02.模块一 直通硅谷大规模数据处理技术/03#统计每个商品的销量"><span class="icon icon-link"></span></a>统计每个商品的销量</h3><p>我们需要的第一个计算集群，就是统计商品销量的集群。</p><p>例如，1000台机器，每台机器一次可以处理1万条销售记录。对于每台机器而言，它的单次处理又回归到了我们熟悉的传统算法，数据规模大大缩小。</p><p>下图就是一个例子，图中每台机器输入是2条销售记录，输出是对于他们的本地输入而言的产品销量计数。</p><p><img src="/blog-worklife/static/httpsstatic001geekbangorgresourceimage8e8a8eeff3376743e886d5f2d481ca8ddb8a.fa894d0a.jpg" alt=""/></p><h3 id="找出销量前k"><a aria-hidden="true" tabindex="-1" href="/blog-worklife/大规模数据处理实战/02.模块一 直通硅谷大规模数据处理技术/03#找出销量前k"><span class="icon icon-link"></span></a>找出销量前K</h3><p>我们需要的第二个计算集群，则是找出销量前十的集群。</p><p>这里我们不妨把问题抽象一下，抽象出是销量前K的产品。因为你的老板随时可能把产品需求改成前20销量，而不是前10了。</p><p>在上一个统计销量集群得到的数据输出，将会是我们这个处理流程的输入。所以这里需要把分布在各个机器分散的产品销量汇总出来。例如，把所有product_id = 1的销量全部叠加。</p><p>下图示例是K = 1的情况，每台机器先把所有product_id = 1的销量叠加在了一起，再找出自己机器上销量前K = 1的商品。可以看到对于每台机器而言，他们的输出就是最终排名前K = 1的商品候选者。</p><p><img src="/blog-worklife/static/httpsstatic001geekbangorgresourceimage38fc38933e25ca315bd56321753573d5bbfc.dd4eb66c.jpg" alt=""/></p><h3 id="汇总最终结果"><a aria-hidden="true" tabindex="-1" href="/blog-worklife/大规模数据处理实战/02.模块一 直通硅谷大规模数据处理技术/03#汇总最终结果"><span class="icon icon-link"></span></a>汇总最终结果</h3><p>到了最后一步，你需要把在“销量前K集群”中的结果汇总出来。也就是说，从所有排名前K=1的商品候选者中找出真正的销量前K=1的商品。</p><p>这时候完全可以用单一机器解决了。因为实际上你汇总的就是这1000台机器的结果，规模足够小。</p><p><img src="/blog-worklife/static/httpsstatic001geekbangorgresourceimagecaabcab28c9e3ba9031072a4e6949328bbab.3fc1cff3.jpg" alt=""/></p><p>看到这里，你已经体会到处理超大规模数据的系统是很复杂的。</p><p>当你辛辛苦苦设计了应对1亿用户的数据处理系统时，可能你就要面临另一个维度的规模化（scaling）。那就是应用场景数量从1个变成1000个。每一次都为不同的应用场景单独设计分布式集群，招募新的工程师维护变得不再“可持续发展”。</p><p>这时，你需要一个数据处理的<strong>框架</strong>。</p><h2 id="大规模数据处理框架的功能要求"><a aria-hidden="true" tabindex="-1" href="/blog-worklife/大规模数据处理实战/02.模块一 直通硅谷大规模数据处理技术/03#大规模数据处理框架的功能要求"><span class="icon icon-link"></span></a>大规模数据处理框架的功能要求</h2><p>在第二讲“MapReduce后谁主沉浮：怎样设计现代大规模数据处理技术”中，我们对于数据处理<strong>框架</strong>已经有了基本的方案。</p><p>今天这个实际的例子其实为我们的设计增加了新的挑战。</p><p>很多人面对问题，第一个想法是找有没有开源技术可以用一下。</p><p>但我经常说服别人不要先去看什么开源技术可以用，而是从自己面对的问题出发独立思考，忘掉MapReduce，忘掉Apache Spark，忘掉Apache Beam。</p><p>如果这个世界一无所有，你会设计怎样的大规模数据处理框架？你要经常做一些思维实验，试试带领一下技术的发展，而不是永远跟随别人的技术方向。</p><p>在我看来，两个最基本的需求是：</p><ol><li><p>高度抽象的数据处理流程描述语言。作为小白用户，我肯定再也不想一一配置分布式系统的每台机器了。作为框架使用者，我希望框架是非常简单的，能够用几行代码把业务逻辑描述清楚。</p></li><li><p>根据描述的数据处理流程，自动化的任务分配优化。这个框架背后的引擎需要足够智能，简单地说，要把那些本来手动配置的系统，进行自动任务分配。</p></li></ol><p>那么理想状况是什么？对于上面的应用场景，我作为用户只想写两行代码。</p><p>第一行代码：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">sales_count = sale_records.Count()</span></div></pre></div><p>这样简单的描述，在我们框架设计层面，就要能自动构建成上文描述的“销量统计计算集群”。</p><p>第二行代码</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">top_k_sales = sales_count.TopK(k)</span></div></pre></div><p>这行代码需要自动构建成上文描述的“找出销量前K集群”。</p><p>看到这里，你能发现这并不复杂。我们到这里就已经基本上把现代大规模数据处理架构的顶层构造掌握了。而背后的具体实现，我会在后面的专栏章节中为你一一揭晓。</p><h2 id="小结"><a aria-hidden="true" tabindex="-1" href="/blog-worklife/大规模数据处理实战/02.模块一 直通硅谷大规模数据处理技术/03#小结"><span class="icon icon-link"></span></a>小结</h2><p>这一讲中，我们粗浅地分析了一个电商排行榜的数据处理例子。</p><p>从GB数据到TB数据，我们从小规模算法升级到了分布式处理的设计方案；从单一TB数据场景到1000个应用场景，我们探索了大规模数据处理框架的设计。</p><p>这些都是为了帮助你更好地理解后面所要讲的所有知识。比如，为什么传统算法不再奏效？为什么要去借助抽象的数据处理描述语言？希望在后面的学习过程中，你能一直带着这些问题出发。</p><h2 id="思考题"><a aria-hidden="true" tabindex="-1" href="/blog-worklife/大规模数据处理实战/02.模块一 直通硅谷大规模数据处理技术/03#思考题"><span class="icon icon-link"></span></a>思考题</h2><p>在你的工作中，有没有随着数据规模变大，系统出问题的情况，你又是怎么解决的？</p><p>欢迎你把自己的想法写在留言区，与我和其他同学一起讨论。</p><p>如果你觉得有所收获，也欢迎把文章分享给你的朋友。</p></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/GGwujun/blog/edit/master/ssrc/大规模数据处理实战/02.模块一 直通硅谷大规模数据处理技术/03.md">在 GitHub 上编辑此页<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="最后更新时间：">2023/9/29 16:08:09</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script>
      (function () {
        if (!location.port) {
          (function (i, s, o, g, r, a, m) {
            i["GoogleAnalyticsObject"] = r;
            (i[r] =
              i[r] ||
              function () {
                (i[r].q = i[r].q || []).push(arguments);
              }),
              (i[r].l = 1 * new Date());
            (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m);
          })(
            window,
            document,
            "script",
            "//www.google-analytics.com/analytics.js",
            "ga"
          );
          ga("create", "UA-149864185-1", "auto");
          ga("send", "pageview");
        }
      })();
    </script>
    <script src="/blog-worklife/umi.4ad44284.js"></script>
  </body>
</html>
