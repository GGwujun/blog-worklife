<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="/logo.png" />
    <link rel="stylesheet" href="/blog-worklife/umi.3ec1f225.css" />
    <script>
      window.routerBase = "/blog-worklife";
    </script>
    <script>
      //! umi version: 3.5.41
    </script>
    <script>
      !(function () {
        var e =
            navigator.cookieEnabled && void 0 !== window.localStorage
              ? localStorage.getItem("dumi:prefers-color")
              : "auto",
          o = window.matchMedia("(prefers-color-scheme: dark)").matches,
          t = ["light", "dark", "auto"];
        document.documentElement.setAttribute(
          "data-prefers-color",
          e === t[2] ? (o ? t[1] : t[0]) : t.indexOf(e) > -1 ? e : t[0]
        );
      })();
    </script>
    <title>24 | PCollection：为什么Beam要如此抽象封装数据？ - 大师兄</title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/大规模数据处理实战/05.模块四 apache-beam为何能一统江湖/03" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;/logo.png&#x27;)" href="/blog-worklife/">大师兄</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span>后端开发<ul><li><a aria-current="page" class="active" href="/blog-worklife/大规模数据处理实战">大规模数据处理实战</a></li></ul></span><span>工作生活<ul><li><a href="/blog-worklife/10x程序员工作法">10x程序员工作法</a></li><li><a href="/blog-worklife/python自动化办公实战课">python自动化办公实战课</a></li><li><a href="/blog-worklife/人人都用得上的写作课">人人都用得上的写作课</a></li><li><a href="/blog-worklife/体验设计案例课">体验设计案例课</a></li><li><a href="/blog-worklife/基于人因的用户体验设计课">基于人因的用户体验设计课</a></li><li><a href="/blog-worklife/打造爆款短视频">打造爆款短视频</a></li><li><a href="/blog-worklife/用户体验设计实战课">用户体验设计实战课</a></li><li><a href="/blog-worklife/程序员的个人财富课">程序员的个人财富课</a></li><li><a href="/blog-worklife/程序员进阶攻略">程序员进阶攻略</a></li><li><a href="/blog-worklife/讲好故事">讲好故事</a></li><li><a href="/blog-worklife/跟着高手学复盘">跟着高手学复盘</a></li></ul></span><div class="__dumi-default-navbar-tool"><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "></div></div></div></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;/logo.png&#x27;)" href="/blog-worklife/"></a><h1>大师兄</h1><p></p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li>后端开发<ul><li><a aria-current="page" class="active" href="/blog-worklife/大规模数据处理实战">大规模数据处理实战</a></li></ul></li><li>工作生活<ul><li><a href="/blog-worklife/10x程序员工作法">10x程序员工作法</a></li><li><a href="/blog-worklife/python自动化办公实战课">python自动化办公实战课</a></li><li><a href="/blog-worklife/人人都用得上的写作课">人人都用得上的写作课</a></li><li><a href="/blog-worklife/体验设计案例课">体验设计案例课</a></li><li><a href="/blog-worklife/基于人因的用户体验设计课">基于人因的用户体验设计课</a></li><li><a href="/blog-worklife/打造爆款短视频">打造爆款短视频</a></li><li><a href="/blog-worklife/用户体验设计实战课">用户体验设计实战课</a></li><li><a href="/blog-worklife/程序员的个人财富课">程序员的个人财富课</a></li><li><a href="/blog-worklife/程序员进阶攻略">程序员进阶攻略</a></li><li><a href="/blog-worklife/讲好故事">讲好故事</a></li><li><a href="/blog-worklife/跟着高手学复盘">跟着高手学复盘</a></li></ul></li></ul><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "><button title="Dark theme" class="__dumi-default-dark-moon "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3854" width="22" height="22"><path d="M991.816611 674.909091a69.166545 69.166545 0 0 0-51.665455-23.272727 70.795636 70.795636 0 0 0-27.438545 5.585454A415.674182 415.674182 0 0 1 754.993338 698.181818c-209.594182 0-393.472-184.785455-393.472-395.636363 0-52.363636 38.539636-119.621818 69.515637-173.614546 4.887273-8.610909 9.634909-16.756364 14.103272-24.901818A69.818182 69.818182 0 0 0 384.631156 0a70.842182 70.842182 0 0 0-27.438545 5.585455C161.678429 90.298182 14.362065 307.898182 14.362065 512c0 282.298182 238.824727 512 532.38691 512a522.286545 522.286545 0 0 0 453.957818-268.334545A69.818182 69.818182 0 0 0 991.816611 674.909091zM546.679156 954.181818c-248.785455 0-462.941091-192-462.941091-442.181818 0-186.647273 140.637091-372.829091 300.939637-442.181818-36.817455 65.629091-92.578909 151.970909-92.578909 232.727273 0 250.181818 214.109091 465.454545 462.917818 465.454545a488.331636 488.331636 0 0 0 185.181091-46.545455 453.003636 453.003636 0 0 1-393.565091 232.727273z m103.656728-669.323636l-14.266182 83.781818a34.909091 34.909091 0 0 0 50.362182 36.770909l74.775272-39.563636 74.752 39.563636a36.142545 36.142545 0 0 0 16.174546 3.956364 34.909091 34.909091 0 0 0 34.210909-40.727273l-14.289455-83.781818 60.509091-59.345455a35.025455 35.025455 0 0 0-19.223272-59.578182l-83.61891-12.101818-37.376-76.101818a34.56 34.56 0 0 0-62.254545 0l-37.376 76.101818-83.618909 12.101818a34.909091 34.909091 0 0 0-19.246546 59.578182z m70.423272-64.698182a34.280727 34.280727 0 0 0 26.135273-19.083636l14.312727-29.090909 14.336 29.090909a34.257455 34.257455 0 0 0 26.135273 19.083636l32.046546 4.887273-23.272728 22.574545a35.234909 35.234909 0 0 0-10.007272 30.952727l5.46909 32.116364-28.625454-15.127273a34.490182 34.490182 0 0 0-32.302546 0l-28.695272 15.127273 5.469091-32.116364a35.141818 35.141818 0 0 0-9.984-30.952727l-23.272728-22.574545z" p-id="3855"></path></svg></button><button title="Light theme" class="__dumi-default-dark-sun "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4026" width="22" height="22"><path d="M915.2 476.16h-43.968c-24.704 0-44.736 16-44.736 35.84s20.032 35.904 44.736 35.904H915.2c24.768 0 44.8-16.064 44.8-35.904s-20.032-35.84-44.8-35.84zM512 265.6c-136.704 0-246.464 109.824-246.464 246.4 0 136.704 109.76 246.464 246.464 246.464S758.4 648.704 758.4 512c0-136.576-109.696-246.4-246.4-246.4z m0 425.6c-99.008 0-179.2-80.128-179.2-179.2 0-98.944 80.192-179.2 179.2-179.2S691.2 413.056 691.2 512c0 99.072-80.192 179.2-179.2 179.2zM197.44 512c0-19.84-19.136-35.84-43.904-35.84H108.8c-24.768 0-44.8 16-44.8 35.84s20.032 35.904 44.8 35.904h44.736c24.768 0 43.904-16.064 43.904-35.904zM512 198.464c19.776 0 35.84-20.032 35.84-44.8v-44.8C547.84 84.032 531.84 64 512 64s-35.904 20.032-35.904 44.8v44.8c0 24.768 16.128 44.864 35.904 44.864z m0 627.136c-19.776 0-35.904 20.032-35.904 44.8v44.736C476.096 940.032 492.16 960 512 960s35.84-20.032 35.84-44.8v-44.736c0-24.768-16.064-44.864-35.84-44.864z m329.92-592.832c17.472-17.536 20.288-43.072 6.4-57.024-14.016-14.016-39.488-11.2-57.024 6.336-4.736 4.864-26.496 26.496-31.36 31.36-17.472 17.472-20.288 43.008-6.336 57.024 13.952 14.016 39.488 11.2 57.024-6.336 4.8-4.864 26.496-26.56 31.296-31.36zM213.376 759.936c-4.864 4.8-26.56 26.624-31.36 31.36-17.472 17.472-20.288 42.944-6.4 56.96 14.016 13.952 39.552 11.2 57.024-6.336 4.8-4.736 26.56-26.496 31.36-31.36 17.472-17.472 20.288-43.008 6.336-56.96-14.016-13.952-39.552-11.072-56.96 6.336z m19.328-577.92c-17.536-17.536-43.008-20.352-57.024-6.336-14.08 14.016-11.136 39.488 6.336 57.024 4.864 4.864 26.496 26.56 31.36 31.424 17.536 17.408 43.008 20.288 56.96 6.336 14.016-14.016 11.264-39.488-6.336-57.024-4.736-4.864-26.496-26.56-31.296-31.424z m527.168 628.608c4.864 4.864 26.624 26.624 31.36 31.424 17.536 17.408 43.072 20.224 57.088 6.336 13.952-14.016 11.072-39.552-6.4-57.024-4.864-4.8-26.56-26.496-31.36-31.36-17.472-17.408-43.072-20.288-57.024-6.336-13.952 14.016-11.008 39.488 6.336 56.96z" p-id="4027"></path></svg></button><button title="Default to system" class="__dumi-default-dark-auto "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11002" width="22" height="22"><path d="M127.658667 492.885333c0-51.882667 10.24-101.717333 30.378666-149.162666s47.786667-88.064 81.92-122.538667 75.093333-61.781333 122.538667-81.92 96.938667-30.378667 149.162667-30.378667 101.717333 10.24 149.162666 30.378667 88.405333 47.786667 122.88 81.92 61.781333 75.093333 81.92 122.538667 30.378667 96.938667 30.378667 149.162666-10.24 101.717333-30.378667 149.162667-47.786667 88.405333-81.92 122.88-75.093333 61.781333-122.88 81.92-97.28 30.378667-149.162666 30.378667-101.717333-10.24-149.162667-30.378667-88.064-47.786667-122.538667-81.92-61.781333-75.093333-81.92-122.88-30.378667-96.938667-30.378666-149.162667z m329.045333 0c0 130.048 13.994667 244.394667 41.984 343.381334h12.970667c46.762667 0 91.136-9.216 133.461333-27.306667s78.848-42.666667 109.568-73.386667 54.954667-67.242667 73.386667-109.568 27.306667-86.698667 27.306666-133.461333c0-46.421333-9.216-90.794667-27.306666-133.12s-42.666667-78.848-73.386667-109.568-67.242667-54.954667-109.568-73.386667-86.698667-27.306667-133.461333-27.306666h-11.605334c-28.672 123.562667-43.349333 237.909333-43.349333 343.722666z" p-id="11003"></path></svg></button></div></div></div><ul class="__dumi-default-menu-list"><li><a href="/blog-worklife/大规模数据处理实战">大规模数据处理实战</a></li><li><a href="/blog-worklife/大规模数据处理实战/01.开篇词">01.开篇词</a><ul><li><a href="/blog-worklife/大规模数据处理实战/01.开篇词/01"><span>开篇词 | 从这里开始，带你走上硅谷一线系统架构师之路</span></a></li></ul></li><li><a href="/blog-worklife/大规模数据处理实战/02.模块一 直通硅谷大规模数据处理技术">02.模块一 直通硅谷大规模数据处理技术</a><ul><li><a href="/blog-worklife/大规模数据处理实战/02.模块一 直通硅谷大规模数据处理技术/01"><span>01 | 为什么MapReduce会被硅谷一线公司淘汰？</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/02.模块一 直通硅谷大规模数据处理技术/02"><span>02 | MapReduce后谁主沉浮：怎样设计下一代数据处理技术？</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/02.模块一 直通硅谷大规模数据处理技术/03"><span>03 | 大规模数据处理初体验：怎样实现大型电商热销榜？</span></a></li></ul></li><li><a href="/blog-worklife/大规模数据处理实战/03.模块二 实战学习大规模数据处理基本功">03.模块二 实战学习大规模数据处理基本功</a><ul><li><a href="/blog-worklife/大规模数据处理实战/03.模块二 实战学习大规模数据处理基本功/01"><span>04 | 分布式系统（上）：学会用服务等级协议SLA来评估你的系统</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/03.模块二 实战学习大规模数据处理基本功/02"><span>05 | 分布式系统（下）：架构师不得不知的三大指标</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/03.模块二 实战学习大规模数据处理基本功/03"><span>06 | 如何区分批处理还是流处理？</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/03.模块二 实战学习大规模数据处理基本功/04"><span>07 | Workflow设计模式：让你在大规模数据世界中君临天下</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/03.模块二 实战学习大规模数据处理基本功/05"><span>08 | 发布/订阅模式：流处理架构中的瑞士军刀</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/03.模块二 实战学习大规模数据处理基本功/06"><span>09 | CAP定理：三选二，架构师必须学会的取舍</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/03.模块二 实战学习大规模数据处理基本功/07"><span>10 | Lambda架构：Twitter亿级实时数据分析架构背后的倚天剑</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/03.模块二 实战学习大规模数据处理基本功/08"><span>11 | Kappa架构：利用Kafka锻造的屠龙刀</span></a></li></ul></li><li><a href="/blog-worklife/大规模数据处理实战/04.模块三 抽丝剥茧剖析apache-spark设计精髓">04.模块三 抽丝剥茧剖析ApacheSpark设计精髓</a><ul><li><a href="/blog-worklife/大规模数据处理实战/04.模块三 抽丝剥茧剖析apache-spark设计精髓/01"><span>12 | 我们为什么需要Spark？</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/04.模块三 抽丝剥茧剖析apache-spark设计精髓/02"><span>13 | 弹性分布式数据集：Spark大厦的地基（上）</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/04.模块三 抽丝剥茧剖析apache-spark设计精髓/03"><span>14 | 弹性分布式数据集：Spark大厦的地基（下）</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/04.模块三 抽丝剥茧剖析apache-spark设计精髓/04"><span>15 | Spark SQL：Spark数据查询的利器</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/04.模块三 抽丝剥茧剖析apache-spark设计精髓/05"><span>16 | Spark Streaming：Spark的实时流计算API</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/04.模块三 抽丝剥茧剖析apache-spark设计精髓/06"><span>17 | Structured Streaming：如何用DataFrame API进行实时数据分析?</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/04.模块三 抽丝剥茧剖析apache-spark设计精髓/07"><span>18 | Word Count：从零开始运行你的第一个Spark应用</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/04.模块三 抽丝剥茧剖析apache-spark设计精髓/08"><span>19 | 综合案例实战：处理加州房屋信息，构建线性回归模型</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/04.模块三 抽丝剥茧剖析apache-spark设计精髓/09"><span>20 | 流处理案例实战：分析纽约市出租车载客信息</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/04.模块三 抽丝剥茧剖析apache-spark设计精髓/10"><span>21 | 深入对比Spark与Flink：帮你系统设计两开花</span></a></li></ul></li><li><a aria-current="page" class="active" href="/blog-worklife/大规模数据处理实战/05.模块四 apache-beam为何能一统江湖">05.模块四 ApacheBeam为何能一统江湖</a><ul><li><a href="/blog-worklife/大规模数据处理实战/05.模块四 apache-beam为何能一统江湖/01"><span>22 | Apache Beam的前世今生</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/05.模块四 apache-beam为何能一统江湖/02"><span>23 | 站在Google的肩膀上学习Beam编程模型</span></a></li><li><a aria-current="page" class="active" href="/blog-worklife/大规模数据处理实战/05.模块四 apache-beam为何能一统江湖/03"><span>24 | PCollection：为什么Beam要如此抽象封装数据？</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/05.模块四 apache-beam为何能一统江湖/04"><span>25 | Transform：Beam数据转换操作的抽象方法</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/05.模块四 apache-beam为何能一统江湖/05"><span>26 | Pipeline：Beam如何抽象多步骤的数据流水线？</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/05.模块四 apache-beam为何能一统江湖/06"><span>27 | Pipeline I/O: Beam数据中转的设计模式</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/05.模块四 apache-beam为何能一统江湖/07"><span>28 | 如何设计创建好一个Beam Pipeline？</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/05.模块四 apache-beam为何能一统江湖/08"><span>29 | 如何测试Beam Pipeline？</span></a></li></ul></li><li><a href="/blog-worklife/大规模数据处理实战/06.模块五 决战apache-beam真实硅谷案例">06.模块五 决战ApacheBeam真实硅谷案例</a><ul><li><a href="/blog-worklife/大规模数据处理实战/06.模块五 决战apache-beam真实硅谷案例/01"><span>30 | Apache Beam实战冲刺：Beam如何run everywhere?</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/06.模块五 决战apache-beam真实硅谷案例/02"><span>31 | WordCount Beam Pipeline实战</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/06.模块五 决战apache-beam真实硅谷案例/03"><span>32 | Beam Window：打通流处理的任督二脉</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/06.模块五 决战apache-beam真实硅谷案例/04"><span>33 | 横看成岭侧成峰：再战Streaming WordCount</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/06.模块五 决战apache-beam真实硅谷案例/05"><span>34 | Amazon热销榜Beam Pipeline实战</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/06.模块五 决战apache-beam真实硅谷案例/06"><span>35 | Facebook游戏实时流处理Beam Pipeline实战（上）</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/06.模块五 决战apache-beam真实硅谷案例/07"><span>36 | Facebook游戏实时流处理Beam Pipeline实战（下）</span></a></li></ul></li><li><a href="/blog-worklife/大规模数据处理实战/07.模块六 大规模数据处理的挑战与未来">07.模块六 大规模数据处理的挑战与未来</a><ul><li><a href="/blog-worklife/大规模数据处理实战/07.模块六 大规模数据处理的挑战与未来/01"><span>37 | 5G时代，如何处理超大规模物联网数据</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/07.模块六 大规模数据处理的挑战与未来/02"><span>38 | 大规模数据处理在深度学习中如何应用？</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/07.模块六 大规模数据处理的挑战与未来/03"><span>39 | 从SQL到Streaming SQL：突破静态数据查询的次元</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/07.模块六 大规模数据处理的挑战与未来/04"><span>40 | 大规模数据处理未来之路</span></a></li></ul></li><li><a href="/blog-worklife/大规模数据处理实战/08.专栏加餐 特别福利">08.专栏加餐 特别福利</a><ul><li><a href="/blog-worklife/大规模数据处理实战/08.专栏加餐 特别福利/01"><span>FAQ第一期 | 学习大规模数据处理需要什么基础？</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/08.专栏加餐 特别福利/02"><span>加油站 | Practice makes perfect！</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/08.专栏加餐 特别福利/03"><span>FAQ第二期 | Spark案例实战答疑</span></a></li><li><a href="/blog-worklife/大规模数据处理实战/08.专栏加餐 特别福利/04"><span>FAQ第三期 | Apache Beam基础答疑</span></a></li></ul></li><li><a href="/blog-worklife/大规模数据处理实战/09.结束语">09.结束语</a><ul><li><a href="/blog-worklife/大规模数据处理实战/09.结束语/01"><span>结束语 | 世间所有的相遇，都是久别重逢</span></a></li></ul></li><li><a href="/blog-worklife/大规模数据处理实战/summary">大规模数据处理实战</a></li></ul></div></div><ul role="slug-list" class="__dumi-default-layout-toc"><li title="为什么需要PCollection？" data-depth="2"><a href="/blog-worklife/大规模数据处理实战/05.模块四 apache-beam为何能一统江湖/03#为什么需要pcollection"><span>为什么需要PCollection？</span></a></li><li title="为什么PCollection需要Coders？" data-depth="2"><a href="/blog-worklife/大规模数据处理实战/05.模块四 apache-beam为何能一统江湖/03#为什么pcollection需要coders"><span>为什么PCollection需要Coders？</span></a></li><li title="为什么PCollection是无序的？" data-depth="2"><a href="/blog-worklife/大规模数据处理实战/05.模块四 apache-beam为何能一统江湖/03#为什么pcollection是无序的"><span>为什么PCollection是无序的？</span></a></li><li title="为什么PCollection没有固定大小？" data-depth="2"><a href="/blog-worklife/大规模数据处理实战/05.模块四 apache-beam为何能一统江湖/03#为什么pcollection没有固定大小"><span>为什么PCollection没有固定大小？</span></a></li><li title="如何理解PCollection的不可变性？" data-depth="2"><a href="/blog-worklife/大规模数据处理实战/05.模块四 apache-beam为何能一统江湖/03#如何理解pcollection的不可变性"><span>如何理解PCollection的不可变性？</span></a></li><li title="小结" data-depth="2"><a href="/blog-worklife/大规模数据处理实战/05.模块四 apache-beam为何能一统江湖/03#小结"><span>小结</span></a></li><li title="思考题" data-depth="2"><a href="/blog-worklife/大规模数据处理实战/05.模块四 apache-beam为何能一统江湖/03#思考题"><span>思考题</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="24--pcollection为什么beam要如此抽象封装数据"><a aria-hidden="true" tabindex="-1" href="/blog-worklife/大规模数据处理实战/05.模块四 apache-beam为何能一统江湖/03#24--pcollection为什么beam要如此抽象封装数据"><span class="icon icon-link"></span></a>24 | PCollection：为什么Beam要如此抽象封装数据？</h1><p>你好，我是蔡元楠。</p><p>今天我要与你分享的主题是“为什么Beam要如此抽象封装数据”。</p><p>很多人在刚开始接触Apache Beam的时候，都会觉得这里面的概念太抽象了。什么PCollection、PValue、Transform……这都是些什么？尤其是PCollection，完全和先前的技术知识找不到对应。</p><p>确实如此。同样作为数据的容器，PCollection却并不像Python/Java的List或者C加加的vector。PCollection是无序的，Beam对于PCollection中元素的处理顺序不作任何保证。所以，你不可能说“我想处理PCollection中的第二个元素”，因为它就没有“第几个”这种概念。</p><p>PCollection也不像Python/Java的Set，或者C加加的unordered_set，PCollection不一定有固定的边界。所以，你也不能指望去查找一个PCollection的大小。在PCollection的世界里，也没有“固定大小”这样的概念。</p><p>作为程序员，我很讨厌重复造轮子，尤其是新瓶装旧酒。的确，有很多开发者为了体现自己项目的复杂度，故意强行引进了很多概念，让大家都似懂非懂的。这就像是为了体现自己知道茴香豆的“茴”有几种写法一样，故意用另一种写法来体现自己“有文化”。</p><p>那么Apache Beam引进这么多概念，是不是也是故意强行造轮子呢？答案是否定的。这一讲，我们就要分析PCollection为什么会如此设计。</p><p>在之前的章节中，我们已经讲到了Apache Beam的“爷爷”——FlumeJava产生的背景。</p><p>当时Google的工程师们发现MapReduce使用起来并没有很方便。如果计算过程都能够分解成map、shuffle、reduce步骤的话，MapReduce是非常能胜任的。</p><p>但是，很多现实世界中的问题，往往需要一系列的map或reduce步骤。这样的数据流水线就需要额外的代码用来协调这些map或reduce步骤。也需要一些额外的代码去管理分步的map/reduce步骤产生的一些中间结果。以至于新的开发者很难理解复杂的流水线。</p><p>清楚这样的背景对于理解Apache Beam的PCollection起源很有帮助。因为，这个项目起源只是为了提供比MapReduce更好的开发体验，最终的运算引擎仍然是MapReduce。</p><h2 id="为什么需要pcollection"><a aria-hidden="true" tabindex="-1" href="/blog-worklife/大规模数据处理实战/05.模块四 apache-beam为何能一统江湖/03#为什么需要pcollection"><span class="icon icon-link"></span></a>为什么需要PCollection？</h2><p>那么，为什么Beam需要PCollection这样一个全新的抽象数据结构呢？</p><p>我们知道，不同的技术系统有不同的数据结构。比如，C加加里有vector、unordered_map，安卓有ListView。相比它们而言，其实Beam的数据结构体系是很单调的，几乎所有数据都能表达为PCollection。</p><p>PCollection，就是Parallel Collection，意思是可并行计算的数据集。如果你之前学习了Spark的章节，就会发现PCollection和RDD十分相似。</p><p>在一个分布式计算系统中，我们作为架构设计者需要为用户隐藏的实现细节有很多，其中就包括了<strong>数据是怎样表达和存储的</strong>。</p><p>这个数据可能是来自于内存的数据（内部可能只是由一个C加加 array存储）；也有可能是来自外部文件（由几个文件存储）；或者是来自于MySQL数据库（由数据库的行来表达）。</p><p>如果没有一个统一的数据抽象的话，开发者就需要不停地更改代码。比如，在小规模测试的时候用C加加 vector，等到了真实的生产环境，我再换MySQL row。沉溺于这样的实现细节会让开发者无法集中注意力在真正重要的事情上，那就是“你想怎样处理数据”。</p><p>清楚了这些，你就能明白我们需要一层抽象来表达数据，而这层抽象就是PCollection。</p><p>PCollection的创建完全取决于你的需求。比如，在测试中PCollection往往来自于代码生成的伪造数据，或者从文件中读取。</p><p>Python</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">lines = (p</span></div><div class="token-line"><span class="token plain">               | beam.Create([&#x27;To be, or not to be: that is the question. &#x27;]))</span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">    lines = p | &#x27;ReadMyFile&#x27; &gt;&gt; beam.io.ReadFromText(&#x27;gs://some/inputData.txt&#x27;</span></div></pre></div><p>Java</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">PCollection&lt;String&gt; lines = p.apply(</span></div><div class="token-line"><span class="token plain">          &quot;ReadMyFile&quot;, TextIO.read().from(&quot;protocol://path/to/some/inputData.txt&quot;));</span></div></pre></div><h2 id="为什么pcollection需要coders"><a aria-hidden="true" tabindex="-1" href="/blog-worklife/大规模数据处理实战/05.模块四 apache-beam为何能一统江湖/03#为什么pcollection需要coders"><span class="icon icon-link"></span></a>为什么PCollection需要Coders？</h2><p>与普通编程相比，PCollection的另一个不同之处是，你需要为PCollection的元素编写Coder。例如，你有一个自己的类MyClass，那么PCollection一定需要实现Coder。</p><p>刚开始使用Beam时，你可能会感觉这很不方便。例如，你只是要去读取MySQL的一个表，也得为此实现Coder。</p><p>Coder的作用和Beam的本质紧密相关。因为你的计算流程最终会运行在一个分布式系统。所以，所有的数据都有可能在网络上的计算机之间相互传递。而Coder就是在告诉Beam，怎样把你的数据类型序列化和逆序列化，以方便在网络上传输。</p><p>Coder需要注册进全局的CoderRegistry中，简单来说，是为你自己的数据类型建立与Coder的对应关系。不然每次你都需要手动指定Coder。</p><p>Python</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">apache_beam.coders.registry.register_coder(int, BigEndianIntegerCoder)</span></div></pre></div><p>Java</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">PipelineOptions options = PipelineOptionsFactory.create();</span></div><div class="token-line"><span class="token plain">    Pipeline p = Pipeline.create(options);</span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">    CoderRegistry cr = p.getCoderRegistry();</span></div><div class="token-line"><span class="token plain">    cr.registerCoder(Integer.class, BigEndianIntegerCoder.class);</span></div></pre></div><h2 id="为什么pcollection是无序的"><a aria-hidden="true" tabindex="-1" href="/blog-worklife/大规模数据处理实战/05.模块四 apache-beam为何能一统江湖/03#为什么pcollection是无序的"><span class="icon icon-link"></span></a>为什么PCollection是无序的？</h2><p>讲完为什么PCollection需要Coder之后，我们再来看下，为什么PCollection是无序的。</p><p>PCollection的无序特性其实也和它的分布式本质有关。一旦一个PCollection被分配到不同的机器上执行，那么为了保证最大的处理输出，不同机器都是独立运行的。所以，它的执行顺序就无从得知了。可能是第一个元素先被运行，也可能是第二个元素先被运行。所以，肯定不会有PCollection[2]这样的运算符。</p><h2 id="为什么pcollection没有固定大小"><a aria-hidden="true" tabindex="-1" href="/blog-worklife/大规模数据处理实战/05.模块四 apache-beam为何能一统江湖/03#为什么pcollection没有固定大小"><span class="icon icon-link"></span></a>为什么PCollection没有固定大小？</h2><p>无序也就算了，为什么PCollection还没有固定大小呢？</p><p>前面的章节中讲到过，Beam想要统一批处理和流处理，所以它要统一表达有界数据和无界数据。正因为如此，PCollection并没有限制它的容量。如前面所说，它可能表达内存上的一个数组，也可能表达整个数据库的所有数据。</p><p>一个PCollection可以是有界的，也可以是无界的。一个有界的PCollection表达了一个已知大小的固定的数据集。一个无界的PCollection表达了一个无限大小的数据集。事实上一个PCollection是否有界，往往取决于它是如何产生的。</p><p>从批处理的数据源中读取，比如一个文件或者是一个数据库，就会产生有界的PColleciton。如果从流式的或者是持续更新的数据库中读取，比如pub/sub或者kafka，会产生一个无界的PCollection。</p><p>但是，PCollection的有界和无界特性会影响到Beam的数据处理方式。一个批处理作业往往处理有界数据。而无界的PCollection需要流式的作业来连续处理。</p><p>在实现中，Beam也是用window来分割持续更新的无界数据。所以，一个流数据可以被持续地拆分成不同的小块。这样的处理方式我们会在实战部分展开。</p><h2 id="如何理解pcollection的不可变性"><a aria-hidden="true" tabindex="-1" href="/blog-worklife/大规模数据处理实战/05.模块四 apache-beam为何能一统江湖/03#如何理解pcollection的不可变性"><span class="icon icon-link"></span></a>如何理解PCollection的不可变性？</h2><p>在普通编程语言中，大部分数据结构都是可变的。</p><p>Python</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">Alist = []</span></div><div class="token-line"><span class="token plain">    alist.append(1)</span></div></pre></div><p>C加加</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">Std::vector&lt;int&gt; list;</span></div><div class="token-line"><span class="token plain">    list.push_back(1);</span></div></pre></div><p>但是PCollection不提供任何修改它所承载数据的方式。修改一个PCollection的唯一方式就是去转化(Transform)它，下一讲会展开讲Transformation。</p><p>但是在这一讲，我们需要理解的是，Beam的PCollection都是延迟执行（deferred execution）的模式。也就是说，当你下面这样的语句的时候，什么也不会发生。</p><p>Java</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">PCollection&lt;T1&gt; p1 = ...;</span></div><div class="token-line"><span class="token plain">    PCollection&lt;T2&gt; p2 = doSomeWork(p1);</span></div></pre></div><p>这样的语句执行完，p2这个PCollection仅仅会记录下自己是由doSomeWork这个操作计算而来的，和计算自己所需要的数据p1。当你执行写完100行的beam的运算操作，最终的结果仅仅是生成了一个有向无环图（DAG），也就是执行计划（execution plan）。</p><p>为什么这么设计呢？如果你记得我们在专栏第一部分讲到的大规模数据框架设计，可能会有印象。这样的有向无环图是框架能够自动优化执行计划的核心。</p><p><img src="/blog-worklife/static/httpsstatic001geekbangorgresourceimage885b88ce2f3effcf035f838ffcfd382c0b5b.78775f90.png" alt=""/></p><p>类似图中这样的数据处理流程，在Beam获知了整个数据处理流程后，就会被优化成下图所示。</p><p><img src="data:image/png;base64,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" alt=""/></p><p>这样的优化，在Beam中被称为sibling fusion。类似的操作优化我们后面会继续介绍。在这个小标题下，我想用这个优化的例子说明，PCollection下的数据不可变是因为改变本身毫无意义。</p><p>例如，在刚才这个例子中，你会发现，优化后的执行计划里已经没有了数据A0。因为，Beam发现数据A0作为中间结果并不影响最终输出。另外，由于Beam的分布式本质，即使你想要去修改一个PCollection的底层表达数据，也需要在多个机器上查找，毫无实现的价值。</p><h2 id="小结"><a aria-hidden="true" tabindex="-1" href="/blog-worklife/大规模数据处理实战/05.模块四 apache-beam为何能一统江湖/03#小结"><span class="icon icon-link"></span></a>小结</h2><p>这一讲我们介绍了整个Beam核心数据结构PCollection的设计思想。尤其是分析了PCollection的几大特性为什么是这么设计的。它的特性包括Coders、无序性、没有固定大小、不可变性等。在每个特性下面我们也介绍了几个例子或者代码示例，希望能帮助你加深印象。</p><h2 id="思考题"><a aria-hidden="true" tabindex="-1" href="/blog-worklife/大规模数据处理实战/05.模块四 apache-beam为何能一统江湖/03#思考题"><span class="icon icon-link"></span></a>思考题</h2><p>PCollection的设计是否能表达你的大规模数据处理场景呢？</p><p>欢迎你把答案写在留言区，与我和其他同学一起讨论。如果你觉得有所收获，也欢迎把文章分享给你的朋友。</p></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/GGwujun/blog/edit/master/ssrc/大规模数据处理实战/05.模块四 ApacheBeam为何能一统江湖/03.md">在 GitHub 上编辑此页<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="最后更新时间：">2023/9/29 16:13:26</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script>
      (function () {
        if (!location.port) {
          (function (i, s, o, g, r, a, m) {
            i["GoogleAnalyticsObject"] = r;
            (i[r] =
              i[r] ||
              function () {
                (i[r].q = i[r].q || []).push(arguments);
              }),
              (i[r].l = 1 * new Date());
            (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m);
          })(
            window,
            document,
            "script",
            "//www.google-analytics.com/analytics.js",
            "ga"
          );
          ga("create", "UA-149864185-1", "auto");
          ga("send", "pageview");
        }
      })();
    </script>
    <script src="/blog-worklife/umi.4ad44284.js"></script>
  </body>
</html>
